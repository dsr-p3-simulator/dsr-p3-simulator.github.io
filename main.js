const t="rgba(255,85,0,0.7)",e=new Set(["KeyW","KeyA","KeyS","KeyD","ArrowUp","ArrowDown","ArrowLeft","ArrowRight"]);let s=new Set;const i=new Set(["Escape","Enter","Space"]),a=[{name:"GamepadA",index:0},{name:"GamepadMenu",index:9}];let r=new Set,n=new Set;function o(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}function h(t,e){for(let s in e)null===e[s]||void 0===e[s]?t.removeAttribute(s):t.setAttribute(s,e[s])}function l(t,e){return t-e+2*e*Math.random()}class u{constructor(t,e,s){this.size=e,this.svg=d("svg"),this.backgroundColor=s;let i=100-e/2;this.svg.setAttribute("viewBox",`${i} ${i} ${e} ${e}`),this.svg.id=t,this.layers={},this.layers.background=this.svg.appendChild(d("g")),h(this.svg.appendChild(d("rect")),{x:""+(i-1),y:""+(i-1),width:`${e+2}`,height:`${e+2}`,fill:this.backgroundColor}),this.layers.arena=this.svg.appendChild(d("g")),this.arenaClipPath=this.svg.appendChild(d("clipPath")),this.arenaClipPath.id=function(t){let e=1,s=t.toString()+"-"+e;for(;document.getElementById(s);)e++,s=t.toString()+e;return s}("xms-arena-clip-path"),this.layers.arenaClippedMechanics=this.svg.appendChild(d("g")),this.layers.arenaClippedMechanics.setAttribute("clip-path",`url(#${this.arenaClipPath.id})`),this.layers.unclippedMechanics=this.svg.appendChild(d("g")),this.layers.enemies=this.svg.appendChild(d("g")),this.layers.dutySupport=this.svg.appendChild(d("g")),this.layers.player=this.svg.appendChild(d("g")),this.layers.partyMemberEffects=this.svg.appendChild(d("g")),this.layers.messages=this.svg.appendChild(d("g")),document.getElementById(t).replaceWith(this.svg)}}function d(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}class c{constructor(){}update(t,e){}addToDrawing(t){}removeFromDrawing(){}allowMovement(t,e){return!0}}class g{#t;#e;constructor(t){this.#t=[],this.#e=t}add(t){return this.#t.push(t),t.addToDrawing(this.#e.drawing),this.#t.length-1}remove(t){for(let[e,s]of this.#t.entries())Object.is(t,s)&&(this.#t[e]=null);t.removeFromDrawing(this.#e.drawing)}update(t,e){for(let s of this.#t)s&&s.update&&s.update(t,e)}allowMovement(t,e){for(let s of this.#t)if(s&&!s.allowMovement(t,e))return!1;return!0}}class p{constructor(t){this.T1=new m("T1","rgb(0,66,197)",1,!1,!1,t),this.H1=new m("H1","rgb(44,197,44)",1,!1,!0,t),this.M1=new m("M1","#f00",1,!0,!1,t),this.R1=new m("R1","#f00",1,!0,!0,t),this.T2=new m("T2","rgb(0,66,197)",2,!1,!1,t),this.H2=new m("H2","rgb(44,197,44)",2,!1,!0,t),this.M2=new m("M2","#f00",2,!0,!1,t),this.R2=new m("R2","#f00",2,!0,!0,t),this.list=[this.T1,this.H1,this.M1,this.R1,this.T2,this.H2,this.M2,this.R2]}reset(){for(let t of this.list)t.reset()}hideDutySupport(){for(let t of this.list)t.player_controlled||t.hide()}showDutySupport(){for(let t of this.list)t.show()}}const f="\n  M-1,-1.25\n  L0,-0.25\n  1,-1.25\n  1.25,-1\n  0.25,0\n  1.25,1\n  1,1.25\n  0,0.25\n  -1,1.25\n  -1.25,1\n  -0.25,0\n  -1.25,-1\n  Z".replaceAll(/\s+/g," ");class m extends c{#s;#i;constructor(t,e,s,i,a,r){super(1),this.label=t,this.color=e,this.KOd=!1,this.isActive=!0,this.lp=s,this.is_dps=i,this.is_ranged=a,this.KO_callback=r,this.target_positions=[],this.player_controlled=!1,this.#s=null}reset(){this.target_positions=[],this.player_controlled=!1,this.layer=1,this.KOd=!1,this.isActive=!0,this.removeFromDrawing()}set_position(t,e){this.x=t,this.y=e}set_target_positions(t){this.target_positions=t}add_target_position(t,e){this.target_positions.push({x:t,y:e})}ko(){if(this.KOd=!0,this.#s){let t=d("path");t.setAttribute("d",f),t.setAttribute("fill","rgba(77,0,0,0.8)"),this.#s.append(t)}}update(t,e){if(this.KOd)return void(this.isActive&&(this.isActive=!1,this.KO_callback()));let i=6*e/1e3;if(this.player_controlled){let e=function(){let t={x:0,y:0};if(s.has("ArrowUp")||s.has("KeyW")?t.y=-1:(s.has("ArrowDown")||s.has("KeyS"))&&(t.y=1),s.has("ArrowRight")||s.has("KeyD")?t.x=1:(s.has("ArrowLeft")||s.has("KeyA"))&&(t.x=-1),0!=t.x||0!=t.y){if(0==t.x||0==t.y)return t;{let e=Math.sqrt(2);return t.x/=e,t.y/=e,t}}if(Navigator.getGamepads)for(let e of Navigator.getGamepads()){if(null===e)continue;if("standard"!=e.mapping)continue;t.x=e.axes[0],t.y=e.axes[1];let s=Math.sqrt(t.x*t.x+t.y*t.y);if(s>=.5)return t.x/=s,t.y/=s,t}return t}(),a=this.x+e.x*i,r=this.y+e.y*i;t.allowMovement({x:e.x,y:e.y},{x:a,y:r})&&(this.x=a,this.y=r)}else{let t=i;for(;this.target_positions.length>0&&t>0;){let e=this.target_positions[0].x-this.x,s=this.target_positions[0].y-this.y,i=Math.sqrt(e*e+s*s);i<=t?(this.x=this.target_positions[0].x,this.y=this.target_positions[0].y,t-=i,this.target_positions.shift()):(this.x+=t*e/i,this.y+=t*s/i,t=0)}}null!==this.#s&&this.#s.setAttribute("transform",`translate(${this.x}, ${this.y})`)}addToDrawing(t){this.#s=d("g"),this.#i&&this.#s.setAttribute("opacity",0);let e=d("circle");e.setAttribute("cx","0"),e.setAttribute("cy","0"),e.setAttribute("r","1.25"),e.setAttribute("fill",this.color),e.setAttribute("stroke-width",.25),e.setAttribute("stroke",this.player_controlled?"#fff":"#000"),this.#s.append(e);let s=d("text");s.textContent=this.label,s.setAttribute("dominant-baseline","central"),s.setAttribute("text-anchor","middle"),s.setAttribute("x","0"),s.setAttribute("y","0"),s.setAttribute("fill","#fff"),s.setAttribute("font-family","monospace"),s.setAttribute("font-size","1.75"),this.#s.append(s),this.#s.setAttribute("transform",`translate(${this.x}, ${this.y})`),this.player_controlled?t.layers.player.append(this.#s):t.layers.dutySupport.append(this.#s)}removeFromDrawing(){null!==this.#s&&(this.#s.remove(),this.#s=null)}hide(){null!==this.#s&&this.#s.setAttribute("opacity",0),this.#i=!0}show(){null!==this.#s&&this.#s.removeAttribute("opacity"),this.#i=!1}}const y="sans-serif";class v extends c{#a;#r;#n;#o;constructor(t,e={x:100,y:100},s=0){super(),this.#a=t,this.#r=e,this.#n=s,this.#o=null}setLocation(t){this.#r=t,this.#h()}setDegreesCWFromN(t){this.#n=t,this.#h()}addToDrawing(t){this.#o=d("path"),this.#o.setAttribute("d","m 0.47070313,-0.01757813 -0.0234375,0.02343751 0.005859,0.0078125 0.015625,-0.01757813 0.0175781,0.01757813 0.007813,-0.0078125 z m -0.94140626,0 -0.0234375,0.02343751 0.007813,0.0078125 0.015625,-0.01562501 0.0175781,0.01562501 0.005859,-0.0078125 z m 0.46783204,-0.42578125 C -0.24644716,-0.44181725 -0.44335937,-0.24393972 -0.44335938,0 c 0,0.12244817 0.0496161,0.23328794 0.12984376,0.31351562 l 0.005332,-0.005332 C -0.38693105,0.22943614 -0.43554687,0.12055663 -0.43554688,0 c 0,-0.24111327 0.19443361,-0.43554687 0.43554688,-0.43554688 0.24111327,0 0.43554687,0.19443361 0.43554688,0.43554688 0,0.12055663 -0.0486158,0.22943614 -0.12736329,0.30818359 l 0.005332,0.005332 C 0.39374331,0.23328793 0.44335937,0.12244817 0.44335938,0 0.44335938,-0.24489635 0.24489635,-0.44335937 0,-0.44335938 c -9.5662635e-4,0 -0.00191589,-6.04e-6 -0.00287109,0 z M 0,-0.50585938 c -0.27884402,0 -0.50585938,0.22701536 -0.50585938,0.50585938 0,0.13942201 0.0567502,0.26589079 0.14835938,0.3575 l 0.007891,-0.007891 C -0.43896446,0.26025429 -0.49414062,0.13671981 -0.49414062,0 c 0,-0.27343963 0.22070099,-0.49414059 0.49414062,-0.49414062 0.27343963,3e-8 0.49414062,0.22070099 0.49414062,0.49414062 0,0.13671981 -0.0551762,0.26025429 -0.14453124,0.34960938 L 0.3575,0.3575 C 0.44910921,0.26589079 0.50585938,0.13942201 0.50585938,0 0.50585938,-0.27884402 0.27884402,-0.50585938 0,-0.50585938 Z M 0,-0.56 a 0.04,0.06 0 0 0 -0.04,0.06 0.04,0.06 0 0 0 1.953e-5,0.001602 A 0.5,0.5 0 0 1 0,-0.5 0.5,0.5 0 0 1 0.03998047,-0.49839844 0.04,0.06 0 0 0 0.04,-0.5 0.04,0.06 0 0 0 0,-0.56 Z"),this.#o.setAttribute("fill","#ff1010"),this.#o.setAttribute("stroke","none"),this.#h(),t.layers.enemies.append(this.#o)}removeFromDrawing(){this.#o&&(this.#o.remove(),this.#o=null)}#h(){this.#o&&this.#o.setAttribute("transform",`translate(${this.#r.x},${this.#r.y}) rotate(${this.#n}) scale(${this.#a})`)}}class b extends c{#l;#u;#d;#c;#g;#p;#s;#f;constructor(t,e){super(0),this.#l=t,this.#u=e,this.#d=0,this.#c=0,this.#g=0,this.#p=0,this.#s=null,this.#f=null}update(t,e){null!==this.#s&&(this.#d+=e,this.#d>=this.#u?this.#c=1:this.#c=this.#d/this.#u,this.#f.setAttribute("width",""+this.#g*this.#c))}addToDrawing(t){this.#g=.75*t.size,this.#p=100-this.#g/2,this.#s=d("g");let e=d("text");e.textContent=this.#l,e.setAttribute("x",`${this.#p}`),e.setAttribute("y",""+(97+t.size/2)),e.setAttribute("fill","#fff"),e.setAttribute("font-family",y),e.setAttribute("font-size","1.5"),this.#s.append(e);let s=""+(98+t.size/2);this.#f=d("rect"),this.#f.setAttribute("x",`${this.#p}`),this.#f.setAttribute("y",s),this.#f.setAttribute("width","0"),this.#f.setAttribute("height","1"),this.#f.setAttribute("fill","rgb(255,189,57)"),this.#s.append(this.#f);let i=this.#f.cloneNode();i.setAttribute("width",`${this.#g}`),i.setAttribute("fill","rgba(0,0,0,0)"),i.setAttribute("stroke-width","0.2"),i.setAttribute("stroke","#fff"),this.#s.append(i),t.layers.messages.append(this.#s)}removeFromDrawing(){null!==this.#s&&(this.#s.remove(),this.#s=null,this.#f=null)}}class x extends c{#l;#m;constructor(t){super(),this.#l=t,this.#m=null}addToDrawing(t){this.#m=d("text"),this.#m.textContent=this.#l,this.#m.setAttribute("text-anchor","middle"),this.#m.setAttribute("x","100"),this.#m.setAttribute("y",""+(104-t.size/2)),this.#m.setAttribute("fill","#fff"),this.#m.setAttribute("font-family",y),this.#m.setAttribute("font-size","2"),t.layers.messages.append(this.#m)}removeFromDrawing(){null!==this.#m&&(this.#m.remove(),this.#m=null)}}class w extends c{#s;constructor(){super(),this.#s=null}addToDrawing(t){this.#s=d("g");let e=d("rect");this.#s.append(e);let s=d("text");s.textContent="Success!",h(s,{"text-anchor":"middle","dominant-baseline":"central",x:"100",y:"100",fill:"#fff","font-family":y,"font-size":"5"}),this.#s.append(s),t.layers.messages.append(this.#s);let i=s.getBBox();h(e,{x:""+(i.x-1.3),y:""+(i.y-.6),width:`${i.width+2.6}`,height:`${i.height+1.2}`,fill:"rgba(0,0,0,0.8)",rx:"1",ry:"1",filter:"blur(0.1)"})}removeFromDrawing(){null!==this.#s&&(this.#s.remove(),this.#s=null)}}class A extends c{#y=null;#s;constructor(t){super(1),this.#y=t,this.#s=null}addToDrawing(t){if(this.#s=d("g"),null!==this.#y){let e=d("rect");e.setAttribute("x",""+(100-t.size/2)),e.setAttribute("y",""+(95+t.size/2)),e.setAttribute("width",`${t.size}`),e.setAttribute("height","6"),e.setAttribute("fill",this.#y),this.#s.append(e)}let e=d("text");e.textContent="Press SPACE or ENTER or gamepad A to restart",e.setAttribute("text-anchor","middle"),e.setAttribute("x","100"),e.setAttribute("y",""+(97+t.size/2)),e.setAttribute("fill","#fff"),e.setAttribute("font-family",y),e.setAttribute("font-size","1.5"),this.#s.append(e);let s=e.cloneNode();s.textContent="Press ESC or the gamepad menu button to change settings",s.setAttribute("y",""+(99+t.size/2)),this.#s.append(s),t.layers.messages.append(this.#s)}removeFromDrawing(){null!==this.#s&&(this.#s.remove(),this.#s=null)}}class _ extends c{#v;#g;#b;#x;#w;#A;constructor(t,e=3.2,s=1.6){super(1),this.#v=t,this.#g=e,this.#b=this.#g/8,this.#x=(this.#g-this.#b)/3,this.#w=-1*s-this.#b/2,this.#A=new Map}update(){this.#A.forEach(((t,e,s)=>{e.setAttribute("transform",`translate(${t.x},${t.y})`)}))}addToDrawing(t){this.#v.forEach(((e,s,i)=>{let a=null,r=this.#w,n=r-this.#x,o=r-this.#x/2;switch(e){case 1:a=[{x:0,y:o}];break;case 2:a=[{x:0-this.#x/2,y:o},{x:this.#x/2,y:o}];break;case 3:a=[{x:0-this.#x/2,y:r},{x:this.#x/2,y:r},{x:0,y:n}];break;case 4:a=[{x:0-this.#x/2,y:r},{x:this.#x/2,y:r},{x:0-this.#x/2,y:n},{x:this.#x/2,y:n}];break;case 5:a=[{x:0-this.#x/2,y:o},{x:this.#x/2,y:n},{x:this.#x/2,y:r},{x:3*this.#x/2,y:n},{x:3*this.#x/2,y:r}];break;case 6:a=[{x:0-this.#x,y:n},{x:0-3*this.#x/2,y:r},{x:0-this.#x/2,y:r},{x:this.#x,y:r},{x:3*this.#x/2,y:n},{x:this.#x/2,y:n}];break;case 7:a=[{x:0-this.#x,y:n},{x:0-3*this.#x/2,y:r},{x:0-this.#x/2,y:r},{x:3*this.#x/2,y:n},{x:this.#x/2,y:n},{x:3*this.#x/2,y:r},{x:this.#x/2,y:r}];break;case 8:a=[{x:0-3*this.#x/2,y:n},{x:0-this.#x/2,y:n},{x:0-3*this.#x/2,y:r},{x:0-this.#x/2,y:r},{x:3*this.#x/2,y:n},{x:this.#x/2,y:n},{x:3*this.#x/2,y:r},{x:this.#x/2,y:r}]}let h=e%2?"#dae8fc":"#ffeaff",l=e%2?"#97c1fc":"#fcaefc",u=d("g");for(const t of a){let e=d("circle");e.setAttribute("cx",t.x),e.setAttribute("cy",t.y),e.setAttribute("r",this.#b),e.setAttribute("fill",h),e.setAttribute("stroke-width",this.#b/8),e.setAttribute("stroke",l),u.append(e)}u.setAttribute("transform",`translate(${s.x},${s.y})`),t.layers.partyMemberEffects.append(u),this.#A.set(u,s)}))}removeFromDrawing(){this.#A.forEach(((t,e,s)=>{e.remove()})),this.#A.clear()}}class T extends c{#_;#T;#d;#M;constructor(){super(),this.#_=[],this.#T=null,this.#d=0,this.#M=!1}addEvent(t,e){this.#_.push({time:t,fn:e}),this.#M&&(this.#$(),t<=this.#d&&(e(),this.#T++))}#$(){this.#_.sort(((t,e)=>t.time-e.time))}start(){this.#_.length>0&&(this.#$(),this.#T=0,this.#d=0,this.#M=!0)}pause(){this.#M=!1}update(t,e){if(this.#M){for(this.#d+=e;this.#T<this.#_.length&&this.#_[this.#T].time<=this.#d;)this.#_[this.#T].fn(),this.#T++;this.#T>=this.#_.length&&(this.#M=!1)}}}
/* @license
License for the xiv-mech-sim library

Copyright 2023 Jen Pollock

Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the “Software”), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
*/class M extends c{#a;#E;#p;#F;#k;#D;#G;constructor(t,e,s){super(-1),this.#a=e,this.#E=s,this.#p=100-e/2,this.#F=100+e/2,this.#k=100-e/2,this.#D=100+e/2,this.#G=null}update(t,e){for(let e of t.party.list)(e.x<this.#p||e.x>this.#F||e.y<this.#k||e.y>this.#D)&&e.ko()}addToDrawing(t){this.#G=d("rect"),this.#G.setAttribute("x",`${this.#p}`),this.#G.setAttribute("y",`${this.#k}`),this.#G.setAttribute("width",`${this.#a}`),this.#G.setAttribute("height",`${this.#a}`),this.#G.setAttribute("fill",this.#E),t.layers.arena.append(this.#G),t.arenaClipPath.append(this.#G.cloneNode())}removeFromDrawing(){this.#G&&(this.#G.remove(),this.#G=null,drawing.arenaClipPath.replaceChildren())}}class ${#R;#S;#C;constructor(t,e,s){if(this.#R=document.createElement("table"),this.#S=new Map,this.#C=new Map,s){let t=document.createElement("tr");this.#S.set(s,t),this.#C.set(s,[]);let e=document.createElement("td");e.className="player",e.setAttribute("style",`background: ${s.color};`),e.innerText=s.label,t.appendChild(e),this.#R.appendChild(t)}let i=[];for(let t=0;t<4;t++)i.push(e[t]),i.push(e[t+4]);for(let t of i)if(!Object.is(t,s)){let e=document.createElement("tr");this.#S.set(t,e);let s=document.createElement("td");s.className="player",s.setAttribute("style",`background: ${t.color};`),s.innerText=t.label,e.appendChild(s),this.#R.appendChild(e),this.#C.set(t,[])}document.getElementById(t).replaceWith(this.#R),this.#R.id="debuffs"}addDebuff(t,e){let s=document.createElement("td");s.className="debuff";let i=document.createElement("img");return i.src=`http://garlandtools.org/files/icons/status/${e}.png`,i.className="debuff",s.id=`${t.label}-${e}`,s.appendChild(i),this.#S.get(t).appendChild(s),this.#C.get(t).push(e),s}removeDebuff(t,e){let s=`${t.label}-${e}`;for(let e of this.#S.get(t).children)if(e.id==s){e.remove();break}let i=this.#S.get(t);for(let t=0;t<i.length;t++)i[t]==e&&i.splice(t,1)}}class E extends v{#s;#I;facing;target;targetLoc;#G;constructor(t){super(4,t),this.#I=!0,this.facing=0,this.target=t}update(t,e){super.update(t,e);let s,i=Number.POSITIVE_INFINITY;for(let e of t.party.list){let t=o(e,this.target);t<i&&(i=t,s=e)}let a=180/Math.PI*(Math.PI/2+Math.atan2(s.y-this.target.y,s.x-this.target.x));this.#I||(super.setDegreesCWFromN(a),this.facing=a*Math.PI/180,this.targetLoc={x:s.x,y:s.y})}angleTo(t){return Math.PI/2+Math.atan2(t.y-100,t.x-100)}castlock(){this.#I=!0}removeCastlock(){this.#I=!1}addToDrawing(t){super.addToDrawing(t),this.#s=d("g"),t.layers.arenaClippedMechanics.append(this.#s)}removeFromDrawing(t){super.removeFromDrawing(t),this.#s.remove()}hit(t){let e=d("rect");e.setAttribute("x",""+(this.target.x-4)),e.setAttribute("y",""+(this.target.y-100)),e.setAttribute("width","8"),e.setAttribute("height","100"),e.setAttribute("fill","rgba(140,40,0,0.8)"),e.setAttribute("transform",`rotate(${180/Math.PI*this.facing} ${this.target.x} ${this.target.y})`),this.#s.append(e);for(let e of t)"T1"!=e.label&&Math.abs((this.targetLoc.x-this.target.x)*(this.target.y-e.y)-(this.target.x-e.x)*(this.targetLoc.y-this.target.y))/Math.hypot(this.targetLoc.x-this.target.x,this.targetLoc.y-this.target.y)<4&&Math.cos(Math.atan2(this.targetLoc.y-this.target.y,this.targetLoc.x-this.target.x)-Math.atan2(e.y-this.target.y,e.x-this.target.x))>0&&e.ko()}}class F extends c{#P;#N;#z;#L;#U;color;#O;constructor(t,e="#3DAEFF"){super(),this.#z=t,this.#P=0,this.#N={x:t.x??100,y:t.y+1??100},this.color=e,this.#U=!1,this.#O=null}update(t,e){super.update(t,e),this.#z.x!=this.#N.x||this.#z.y!=this.#N.y?(this.#P=180/Math.PI*(Math.PI/2+Math.atan2(this.#z.y-this.#N.y,this.#z.x-this.#N.x)),this.#L.setAttribute("d",`M ${this.#z.x-.5} ${this.#z.y-1.5} h 1 l -0.5 ${-Math.sqrt(3)/2} Z`),this.#L.setAttribute("transform",`rotate(${this.#P} ${this.#z.x} ${this.#z.y})`),this.#N={x:this.#z.x,y:this.#z.y}):null===this.#O||this.#z.player_controlled||0!=this.#z.target_positions.length||(this.#P=this.#O,this.#L.setAttribute("transform",`rotate(${this.#P} ${this.#z.x} ${this.#z.y})`),this.#O=null)}addToDrawing(t){this.#L=d("path"),this.#L.setAttribute("d",`M ${this.#z.x-.5} ${this.#z.y-1.5} h 1 l 0 ${-1.5-Math.sqrt(3)/2} Z`),this.#L.setAttribute("fill",this.color),this.#L.setAttribute("fill-opacity",this.#U?"1":"0"),this.#L.setAttribute("transform",`rotate(${this.#P} ${this.#z.x} ${this.#z.y})`),this.#z.player_controlled?t.layers.player.append(this.#L):t.layers.dutySupport.append(this.#L)}removeFromDrawing(t){this.#L&&(this.#L.remove(),this.#L=null)}setVisible(t){this.#U=t,this.#L.setAttribute("fill-opacity",this.#U?"1":"0")}cacheFacing(t){this.#O=t}dropTower(t){return{x:this.#z.x+15*t*Math.cos((this.#P-90)*Math.PI/180),y:this.#z.y+15*t*Math.sin((this.#P-90)*Math.PI/180)}}}class k extends c{#s;constructor(t){super(),this.#s=null}addToDrawing(t){this.#s=d("g"),t.layers.arenaClippedMechanics.append(this.#s)}removeFromDrawing(){this.#s&&(this.#s.remove(),this.#s=null)}hit(t){let e=Math.PI/2+Math.atan2(t.T1.y-100,t.T1.x-100),s=d("rect");s.setAttribute("x","99"),s.setAttribute("y","50"),s.setAttribute("width","2"),s.setAttribute("height","50"),s.setAttribute("fill","rgba(140,40,0,0.8)"),s.setAttribute("transform",`rotate(${180/Math.PI*e} 100 100)`),this.#s.append(s);let i=t.T1;for(let e of t.list)"T1"!=e.label&&Math.abs((i.x-100)*(100-e.y)-(100-e.x)*(i.y-100))/Math.hypot(i.x-100,i.y-100)<1&&Math.cos(Math.atan2(i.y-100,i.x-100)-Math.atan2(e.y-100,e.x-100))>0&&e.ko()}}class D extends c{#s;#K;target;#o;#G;constructor(t){super(),this.#s=null;let e={hit_color:"rgba(5,5,43,0.7)",miss_color:"rgba(140,40,0,0.8)",tower_color:"rgba(120,82,18,0.7)",radius:5,soakCount:1,...t};this.outerRadius=e.radius,this.innerRadius=this.outerRadius-1,this.#K=e.soakCount,this.warning_color=e.tower_color,this.hit_color=e.hit_color,this.miss_color=e.miss_color,this.target=e.target}addToDrawing(t){this.#s=d("g"),this.#o=d("path"),this.#o.setAttribute("d",`M0,-${this.outerRadius}\n    A${this.outerRadius} ${this.outerRadius} 0 0 1 0,${this.outerRadius}\n    A${this.outerRadius} ${this.outerRadius} 0 0 1 0,-${this.outerRadius}\n    M0,-${this.innerRadius}\n    A${this.innerRadius} ${this.innerRadius} 0 0 0 0,${this.innerRadius}\n    A${this.innerRadius} ${this.innerRadius} 0 0 0 0,-${this.innerRadius}`),this.#o.setAttribute("fill",this.has_hit?this.hit_color:this.warning_color),this.#o.setAttribute("transform",`translate(${this.target.x},${this.target.y})`),this.#G=d("rect"),this.#G.setAttribute("x",""+(this.target.x-.5)),this.#G.setAttribute("y",""+(this.target.y-10)),this.#G.setAttribute("width","1"),this.#G.setAttribute("height","10"),this.#G.setAttribute("fill",this.has_hit?this.hit_color:this.warning_color),this.#s.append(this.#o),this.#s.append(this.#G),t.layers.arenaClippedMechanics.append(this.#s)}removeFromDrawing(){null!==this.#o&&(this.#o.remove(),this.#o=null),null!==this.#s&&(this.#s.remove(),this.#s=null),null!==this.#G&&(this.#G.remove(),this.#G=null)}hit(t){let e=[];for(let s of t)Object.is(s,this.target)||o(s,this.target)<=this.outerRadius&&e.push(s);let s=e.length>=this.#K;if(!s)for(let e of t)e.ko();return this.has_hit=!0,null!==this.#o&&(this.innerRadius=0,this.#o.setAttribute("d",`M0,-${this.outerRadius}\n        A${this.outerRadius} ${this.outerRadius} 0 0 1 0,${this.outerRadius}\n        A${this.outerRadius} ${this.outerRadius} 0 0 1 0,-${this.outerRadius}\n        M0,-${this.innerRadius}\n        A${this.innerRadius} ${this.innerRadius} 0 0 0 0,${this.innerRadius}\n        A${this.innerRadius} ${this.innerRadius} 0 0 0 0,-${this.innerRadius}`),this.#o.setAttribute("fill",s?this.hit_color:this.miss_color)),null!==this.#G&&(this.#G.remove(),this.#G=null),this.target={x:this.target.x,y:this.target.y},e}}class G extends v{#I;facing;constructor(){super(15),this.#I=!1}update(t,e){super.update(t,e);let s=180/Math.PI*(Math.PI/2+Math.atan2(t.party.T1.y-100,t.party.T1.x-100));this.#I||(super.setDegreesCWFromN(s),this.facing=s*Math.PI/180)}angleToMT(t){return Math.PI/2+Math.atan2(t.party.T1.y-100,t.party.T1.x-100)}castlock(){this.#I=!0}removeCastlock(){this.#I=!1}autoAttack(t,e){let s=new k;t.timeline.addEvent(e,(()=>{t.entities.add(s),s.hit(t.party)})),t.timeline.addEvent(e+300,(()=>{t.entities.remove(s)}))}angleFromTarget(t){return 180/Math.PI*(Math.PI/2+Math.atan2(100-t.y,100-t.x))}rotateAndNormal(t,e,s){let i=Math.hypot(t.x-100,t.y-100),a=Math.atan2(t.y-100,t.x-100),r=(e-90)*Math.PI/180;return r-a>Math.PI?a+=2*Math.PI:r-a<-Math.PI&&(a-=2*Math.PI),Array(100).fill(0).map(((t,e)=>{let n=i+(e+1)/100*(s-i),o=a+(e+1)/100*(r-a);return{x:100+n*Math.cos(o),y:100+n*Math.sin(o)}}))}}class R extends M{#B;constructor(t){super(t,40,"#b0befc")}addToDrawing(t){super.addToDrawing(t),this.#B=d("image"),this.#B.setAttribute("x","80"),this.#B.setAttribute("y","80"),this.#B.setAttribute("width","40"),this.#B.setAttribute("height","40"),this.#B.setAttribute("href","dsu-p3-cropped.png"),t.layers.arena.append(this.#B)}}class S extends c{#j;constructor(t){let e={hit_color:"rgba(5,5,43,0.7)",...t};super(0),this.targets=e.targets,this.soak_count=e.soak_count,this.radius=e.radius,this.color=e.color,this.hit_color=e.hit_color,this.hasHit=!1,this.#j=[]}hit(t){let e=[],s=[];for(let i of this.targets){let a={x:i.x,y:i.y},r=[];for(let s of t)s.isActive&&o(s,a)<this.radius&&(r.push(s),e.includes(s)?s.ko():e.push(s));if(r.length<this.soak_count)for(let t of r)t.ko();s.push(a)}this.targets=s;for(let t of this.#j)t.setAttribute("fill",this.hit_color),t.setAttribute("stroke","transparent");this.hasHit=!0}update(){let t=0;for(let e of this.targets)this.#j[t].setAttribute("cx",`${e.x}`),this.#j[t].setAttribute("cy",`${e.y}`),t++}addToDrawing(t){let e=this.color,s="transparent";this.hasHit&&(s=this.hit_color,e="transparent");for(const i of this.targets){let a=d("circle");a.setAttribute("cx",`${i.x}`),a.setAttribute("cy",`${i.y}`),a.setAttribute("r",`${this.radius}`),a.setAttribute("fill",s),a.setAttribute("stroke-width",.25),a.setAttribute("stroke",e),this.#j.push(a),t.layers.arenaClippedMechanics.append(a)}}removeFromDrawing(){for(let t of this.#j)t.remove();this.#j=[]}}class C extends c{#H;constructor(e){let s={...{hit_color:"rgba(5,5,43,0.7)",warning_color:t},...e};super(0),this.target=s.target,this.radius=s.radius,this.warning_color=s.warning_color,this.hit_color=s.hit_color,this.has_hit=!1,this.#H=null}hit(t){for(let e of t)Object.is(e,this.target)||o(e,this.target)<=this.radius&&e.ko();this.has_hit=!0,null!==this.#H&&this.#H.setAttribute("fill",this.hit_color),this.target={x:this.target.x,y:this.target.y}}update(){null!==this.#H&&this.#H.setAttribute("transform",`translate(${this.target.x},${this.target.y})`)}addToDrawing(t){this.#H=d("circle"),this.#H.setAttribute("cx","0"),this.#H.setAttribute("cy","0"),this.#H.setAttribute("r",`${this.radius}`),this.#H.setAttribute("fill",this.has_hit?this.hit_color:this.warning_color),this.#H.setAttribute("transform",`translate(${this.target.x},${this.target.y})`),t.layers.arenaClippedMechanics.append(this.#H)}removeFromDrawing(){null!==this.#H&&(this.#H.remove(),this.#H=null)}}class I extends c{#o;constructor(e){let s={...{hit_color:"rgba(5,5,43,0.7)",warning_color:t},...e};super(0),this.target=s.target,this.innerRadius=s.inner_radius,this.outerRadius=s.outer_radius,this.warning_color=s.warning_color,this.hit_color=s.hit_color,this.has_hit=!1,this.#o=null}hit(t){for(let e of t){if(Object.is(e,this.target))continue;let t=o(e,this.target);t>this.innerRadius&&t<=this.outerRadius&&e.ko()}this.has_hit=!0,null!==this.#o&&this.#o.setAttribute("fill",this.hit_color),this.target={x:this.target.x,y:this.target.y}}update(){null!==this.#o&&this.#o.setAttribute("transform",`translate(${this.target.x},${this.target.y})`)}addToDrawing(t){this.#o=d("path"),this.#o.setAttribute("d",`M0,-${this.outerRadius}\n    A${this.outerRadius} ${this.outerRadius} 0 0 1 0,${this.outerRadius}\n    A${this.outerRadius} ${this.outerRadius} 0 0 1 0,-${this.outerRadius}\n    M0,-${this.innerRadius}\n    A${this.innerRadius} ${this.innerRadius} 0 0 0 0,${this.innerRadius}\n    A${this.innerRadius} ${this.innerRadius} 0 0 0 0,-${this.innerRadius}`),this.#o.setAttribute("fill",this.has_hit?this.hit_color:this.warning_color),this.#o.setAttribute("transform",`translate(${this.target.x},${this.target.y})`),t.layers.arenaClippedMechanics.append(this.#o)}removeFromDrawing(){null!==this.#o&&(this.#o.remove(),this.#o=null)}}const P=15401,N=15402,z=15403,L=15389,U=15390,O=15391;let K;new class{#W;#M;#q;#V;#Z;#Y;#J;constructor(t){this.#q=t.placeholderId,this.#V=t.drawingSize,this.backgroundColor=t.backgroundColor,this.#Z=document.getElementById(t.menuId),this.entities=null,this.timeline=null,this.#W=null,this.#M=!1,this.#Y=0,this.#J=t.initFn}run(){window.addEventListener("keydown",(t=>{e.has(t.code)&&s.add(t.code)})),window.addEventListener("keyup",(t=>{s.delete(t.code),i.has(t.code)&&n.add(t.code)})),document.getElementById("start").addEventListener("click",(t=>{this.startPull()})),this.#Z.addEventListener("cancel",(t=>{this.startPull()})),this.#Z.showModal()}startPull(){this.drawing=new u(this.#q,this.#V,this.backgroundColor),this.party=new p((()=>this.endRun())),this.entities=new g(this),this.timeline=new T,this.entities.add(this.timeline),this.#J(this);for(let t of this.party.list)document.querySelector(`input[type="radio"][name="player"][value="${t.label}"]`).checked&&(t.player_controlled=!0,t.show(),t.layer=2,this.player=t),this.entities.add(t);null!==this.#W&&clearInterval(this.#W),this.#Y=Date.now(),this.#W=setInterval((()=>this.update()),1e3/60),this.timeline.start(),this.#M=!0}update(){let t=this.drawing.svg.suspendRedraw(1e3/60),e=Date.now(),s=e-this.#Y;this.#Y=e,function(){if(Navigator.getGamepads)for(let t of Navigator.getGamepads())for(let e of a)t.buttons[e.index].pressed?r.add(e.name):r.has(e.name)&&(r.delete(e.name),n.add(e.name),console.log(n))}(),this.#M?this.entities.update(this,s):this.#Z.open||((n.has("Escape")||n.has("GamepadMenu"))&&(n.delete("Escape"),n.delete("GamepadMenu"),1)?this.#Z.showModal():(n.has("Space")||n.has("Enter")||n.has("GamepadA"))&&(n.delete("Space"),n.delete("Enter"),n.delete("GamepadA"),1)&&this.startPull()),this.drawing.svg.unsuspendRedraw(t)}endRun(){this.#M=!1,this.entities.add(new A(this.backgroundColor)),n.clear()}allowMovement(t,e){return this.entities.allowMovement(t,e)}}({placeholderId:"sim",drawingSize:50,backgroundColor:"#00072b",menuId:"menu",initFn:function(t){!function(t){let e=t.party.list.slice();const s=Math.floor(7*Math.random());let i=["1","3"];for(let t=1;t<=3;t++)2>>t-1&s?(i.push(`${t}U`),i.push(`${t}D`)):(i.push(`${t}`),i.push(`${t}`));console.log(i),B.debuffs=new Map;for(let t=0;t<8;t++){let s=Math.floor(Math.random()*e.length);B.debuffs.set(e[s],i[t]),e.splice(s,1)}B.lashes=[Math.random()>.5,Math.random()>.5],console.log(JSON.stringify(B))}(t),t.entities.add(new R(t)),document.getElementById("bgm").pause(),document.getElementById("bgm").volume=parseInt(document.getElementById("volume-slider").value)/100,document.getElementById("bgm").currentTime=0,function(t){J=new Map;let e=!1;t.timeline.addEvent(1,(()=>{K=new $("debuffs",t.party.list,t.player);for(let s of t.party.list){let i=new F(s);J.set(s,i),t.entities.add(i),s.player_controlled&&(i.setVisible(!0),e=!0)}if(!e)for(let[t,e]of J)e.setVisible(!0)})),Y=new G;let s=new x("Thy final verse is sung!"),i=new x("Thou hast survived my song..."),a=new x("Curse thee and thine eye, Hraesvelgr!");t.timeline.addEvent(j,(()=>{t.entities.add(Y),t.entities.add(s)})),t.timeline.addEvent(H,(()=>{t.entities.remove(s),t.entities.add(i)})),Y.autoAttack(t,H),t.timeline.addEvent(H+3e3,(()=>{t.entities.remove(i),t.entities.add(a)})),Y.autoAttack(t,H+3e3),t.timeline.addEvent(H+6e3,(()=>{t.entities.remove(a)})),Y.autoAttack(t,H+6e3);let r=new Map;for(let[t,e]of B.debuffs)r.set(t,e.charCodeAt(0)-48);let n=new _(r),o=new b("Dive From Grace",4700);t.timeline.addEvent(W,(()=>{t.entities.add(o),t.entities.add(n);for(let e of t.party.list)switch(B.debuffs.get(e)){case"1":case"1U":case"1D":K.addDebuff(e,P);break;case"2":case"2U":case"2D":K.addDebuff(e,N);break;case"3":case"3U":case"3D":K.addDebuff(e,z)}Y.castlock()})),t.timeline.addEvent(W+4800,(()=>{t.entities.remove(o),t.entities.remove(n);for(let e of t.party.list)switch(B.debuffs.get(e)){case"1U":case"2U":case"3U":K.addDebuff(e,U);break;case"1":case"2":case"3":K.addDebuff(e,L);break;case"1D":case"2D":case"3D":K.addDebuff(e,O)}}));let h=new b(B.lashes[0]?"Lash and Gnash":"Gnash and Lash",7300);t.timeline.addEvent(q,(()=>{t.entities.add(h)}));let l,u=[];for(let e of t.party.list)B.debuffs.get(e).startsWith("1")&&u.push(new C({target:e,radius:5}));t.timeline.addEvent(q+7400,(()=>{t.entities.remove(h);let e=[];for(let s of u){switch(t.entities.add(s),K.removeDebuff(s.target,P),B.debuffs.get(s.target)){case"1":K.removeDebuff(s.target,L),Q.push(J.get(s.target).dropTower(0));break;case"1U":K.removeDebuff(s.target,U),Q.push(J.get(s.target).dropTower(1));break;case"1D":K.removeDebuff(s.target,O),Q.push(J.get(s.target).dropTower(-1))}e.push(s.target),s.hit(t.party.list)}let s,i=[100+7.5*Math.sin(Y.facing),100-7.5*Math.cos(Y.facing)],a=Number.POSITIVE_INFINITY;for(let e of t.party.list){let t=Math.hypot(e.x-i[0],e.y-i[1]);t<a&&(a=t,s=e)}l=new S({targets:[s],soak_count:5,radius:5}),t.entities.add(l),l.hit(t.party.list);for(let t of e)(Object.is(s,t)||Math.hypot(s.x-t.x,s.y-t.y)<5)&&s.ko()})),t.timeline.addEvent(q+7800,(()=>{for(let e of u)t.entities.remove(e);t.entities.remove(l)}));let d=new C({target:{x:100,y:100},radius:7.5}),c=new I({target:{x:100,y:100},inner_radius:7.5,outer_radius:80});t.timeline.addEvent(q+11300,(()=>{B.lashes[0]?(t.entities.add(c),c.hit(t.party.list)):(t.entities.add(d),d.hit(t.party.list)),Q=Q.map((e=>{let s=new D({target:e});return t.entities.add(s),s}))})),t.timeline.addEvent(q+11700,(()=>{B.lashes[0]?t.entities.remove(c):t.entities.remove(d)})),t.timeline.addEvent(q+14400,(()=>{B.lashes[0]?(t.entities.add(d),d.hit(t.party.list)):(t.entities.add(c),c.hit(t.party.list));for(let e of Q)e.hit(t.party.list)}));let g=[];t.timeline.addEvent(q+14800,(()=>{B.lashes[0]?t.entities.remove(d):t.entities.remove(c);for(let e of Q){t.entities.remove(e);let s=new E(e.target);g.push(s),t.entities.add(s)}})),t.timeline.addEvent(q+16600,(()=>{for(let t of g)t.removeCastlock()})),t.timeline.addEvent(q+16800,(()=>{for(let t of g)t.castlock()}));let p=[];for(let e of t.party.list)B.debuffs.get(e).startsWith("2")&&p.push(new C({target:e,radius:5}));t.timeline.addEvent(q+17500,(()=>{let e=[];Q=[];for(let s of p){switch(t.entities.add(s),K.removeDebuff(s.target,N),B.debuffs.get(s.target)){case"2":K.removeDebuff(s.target,L),Q.push(J.get(s.target).dropTower(0));break;case"2U":K.removeDebuff(s.target,U),Q.push(J.get(s.target).dropTower(1));break;case"2D":K.removeDebuff(s.target,O),Q.push(J.get(s.target).dropTower(-1))}e.push(s.target),s.hit(t.party.list)}})),t.timeline.addEvent(q+17900,(()=>{for(let e of p)t.entities.remove(e)})),t.timeline.addEvent(q+21200,(()=>{for(let e of g)e.hit(t.party.list)}));let f,m=new b(B.lashes[1]?"Lash and Gnash":"Gnash and Lash",7300);t.timeline.addEvent(V,(()=>{t.entities.add(m)})),t.timeline.addEvent(V+200,(()=>{Q=Q.map((e=>{let s=new D({target:e});return t.entities.add(s),s}));for(let e of g)t.entities.remove(e)})),t.timeline.addEvent(V+2400,(()=>{for(let e of Q)e.hit(t.party.list)})),t.timeline.addEvent(V+2800,(()=>{g=[];for(let e of Q){t.entities.remove(e);let s=new E(e.target);g.push(s),t.entities.add(s)}})),t.timeline.addEvent(V+4600,(()=>{for(let t of g)t.removeCastlock()})),t.timeline.addEvent(V+4800,(()=>{for(let t of g)t.castlock()})),Q=[];let y=[];for(let e of t.party.list)B.debuffs.get(e).startsWith("3")&&y.push(new C({target:e,radius:5}));t.timeline.addEvent(V+7400,(()=>{t.entities.remove(m);let e=[];Q=[];for(let s of y){switch(t.entities.add(s),K.removeDebuff(s.target,z),B.debuffs.get(s.target)){case"3":K.removeDebuff(s.target,L),Q.push(J.get(s.target).dropTower(0));break;case"3U":K.removeDebuff(s.target,U),Q.push(J.get(s.target).dropTower(1));break;case"3D":K.removeDebuff(s.target,O),Q.push(J.get(s.target).dropTower(-1))}e.push(s.target),s.hit(t.party.list)}let s,i=[100+7.5*Math.sin(Y.facing),100-7.5*Math.cos(Y.facing)],a=Number.POSITIVE_INFINITY;for(let e of t.party.list){let t=Math.hypot(e.x-i[0],e.y-i[1]);t<a&&(a=t,s=e)}f=new S({targets:[s],soak_count:5,radius:5}),t.entities.add(f),f.hit(t.party.list);for(let t of e)(Object.is(s,t)||Math.hypot(s.x-t.x,s.y-t.y)<5)&&s.ko()})),t.timeline.addEvent(V+7800,(()=>{for(let e of y)t.entities.remove(e);t.entities.remove(f)})),t.timeline.addEvent(V+9600,(()=>{for(let e of g)e.hit(t.party.list)})),t.timeline.addEvent(V+10100,(()=>{for(let e of g)t.entities.remove(e)}));let v=new C({target:{x:100,y:100},radius:7.5}),A=new I({target:{x:100,y:100},inner_radius:7.5,outer_radius:80});t.timeline.addEvent(V+11300,(()=>{B.lashes[1]?(t.entities.add(A),A.hit(t.party.list)):(t.entities.add(v),v.hit(t.party.list)),Q=Q.map((e=>{let s=new D({target:e});return t.entities.add(s),s}))})),t.timeline.addEvent(V+11700,(()=>{B.lashes[1]?t.entities.remove(A):t.entities.remove(v)})),t.timeline.addEvent(V+14400,(()=>{B.lashes[1]?(t.entities.add(v),v.hit(t.party.list)):(t.entities.add(A),A.hit(t.party.list));for(let e of Q)e.hit(t.party.list)})),t.timeline.addEvent(V+14800,(()=>{B.lashes[1]?t.entities.remove(v):t.entities.remove(A),g=[];for(let e of Q){t.entities.remove(e);let s=new E(e.target);g.push(s),t.entities.add(s)}})),t.timeline.addEvent(V+16600,(()=>{for(let t of g)t.removeCastlock()})),t.timeline.addEvent(V+16800,(()=>{for(let t of g)t.castlock()})),t.timeline.addEvent(V+18500,(()=>{Y.removeCastlock()})),Y.autoAttack(t,V+18500),t.timeline.addEvent(V+20800,(()=>{for(let e of g)e.hit(t.party.list)})),t.timeline.addEvent(V+21300,(()=>{for(let e of g)t.entities.remove(e)})),Y.autoAttack(t,V+21500),t.timeline.addEvent(Z,(()=>{t.entities.add(new w),t.endRun()}))}(t),function(t){let e=t.party.list;for(let t of e)t.set_position(l(100,.5),l(105,.5));t.party.T1.set_position(100,92.5),t.timeline.addEvent(j+500,(()=>{let s=[];for(let i of e){if(Object.is(i,t.party.T1))continue;let e,a=!1;for(;!a;){a=!0,e=Math.random()*Math.PI+Math.PI/2;for(let t of s)Math.abs(e-t)<Math.PI/12&&(a=!1)}s.push(e);let r={x:l(100+7.5*Math.sin(e),.3),y:l(100-7.5*Math.cos(e),.3)};i.set_target_positions([r]),J.get(i).cacheFacing(Y.angleFromTarget(r))}}));let s,i,a,r=[],n=Array(3).fill(null),o=[],h=Array(3).fill(null),u=[],d=Array(3).fill(null);t.timeline.addEvent(W+700,(()=>{for(let t of e){let e=B.debuffs.get(t);switch(e){case"1U":n[0]=t,r.push(t);break;case"1D":n[2]=t,r.push(t);break;case"1":n[1]=t,r.push(t);break;case"2U":h[0]=t,o.push(t);break;case"2D":h[2]=t,o.push(t);break;case"2":h[1]=t,o.push(t);break;case"3U":d[0]=t,u.push(t);break;case"3D":d[2]=t,u.push(t);break;case"3":d[1]=t,u.push(t);break;default:console.error(`Recieved invalid debuff ${e}`)}}r.sort(((t,e)=>t.x-e.x)),s=[{x:92.5,y:100},{x:100,y:107.5},{x:107.5,y:100}];for(let t=0;t<3;t++)r[t].set_target_positions([s[t]]),J.get(r[t]).cacheFacing(Y.angleFromTarget(s[t])),Object.is(n[2],null)&&(n[t]=r[t]);u.sort(((t,e)=>t.x-e.x)),a=[{x:95,y:100},{x:100,y:105},{x:105,y:100}];for(let t=0;t<3;t++)u[t].set_target_positions([a[t]]),J.get(u[t]).cacheFacing(Y.angleFromTarget(a[t])),Object.is(d[2],null)&&(d[t]=u[t]);o.sort(((t,e)=>t.x-e.x)),i=[{x:98,y:94},{x:102,y:94}];for(let t=0;t<2;t++)o[t].set_target_positions([i[t]]),J.get(o[t]).cacheFacing(Y.angleFromTarget(i[t])),Object.is(h[2],null)&&(h[t]=o[t]);h[1]??=h[2],console.log(n,h,d)})),t.timeline.addEvent(q+700,(()=>{for(let t=0;t<3;t++)n[t].set_target_positions([s[t]]),J.get(n[t]).cacheFacing(Y.angleFromTarget(s[t]));for(let t of e)switch(B.debuffs.get(t)){case"2":case"2U":case"2D":case"3":case"3U":case"3D":let e={x:l(100,.5),y:l(92.5+(B.lashes[0]?1:-1),.5)};t.set_target_positions([e]),J.get(t).cacheFacing(Y.angleFromTarget(e))}})),t.timeline.addEvent(q+6300,(()=>{for(let t of e)"1D"==B.debuffs.get(t)&&J.get(t).cacheFacing(Y.angleFromTarget(t)+180)})),t.timeline.addEvent(q+8e3,(()=>{for(let t of e)switch(B.debuffs.get(t)){case"1":case"1U":case"1D":if(B.lashes[0]){let e={x:l(100,1),y:l(94.5,1)};t.set_target_positions([e]),J.get(t).cacheFacing(Y.angleFromTarget(e))}else{let e=Y.rotateAndNormal(t,l(0,5),l(9.5,.5));t.set_target_positions(e),J.get(t).cacheFacing(Y.angleFromTarget(e[99]))}}for(let t=0;t<3;t++){let e;if(B.lashes[0])e=Y.rotateAndNormal(d[t],90*(3-t),5.5)[99],d[t].set_target_positions([e]);else{let s=Y.rotateAndNormal(d[t],90*(3-t),9.5);d[t].set_target_positions(s),e=s[99]}J.get(d[t]).cacheFacing(Y.angleFromTarget(e))}})),t.timeline.addEvent(q+11700,(()=>{for(let t of e)switch(B.debuffs.get(t)){case"1":case"1U":case"1D":case"2":case"2U":case"2D":if(B.lashes[0]){let e=Y.rotateAndNormal(t,l(0,5),l(9.5,.5));t.set_target_positions(e),J.get(t).cacheFacing(Y.angleFromTarget(e[99]))}else{let e={x:l(100,1),y:l(94.5,1)};t.set_target_positions([e]),J.get(t).cacheFacing(Y.angleFromTarget(e))}}for(let t=0;t<3;t++){let e;if(B.lashes[0])e=Y.rotateAndNormal(d[t],90*(3-t),9.5)[99],d[t].set_target_positions([e]);else{let s=Y.rotateAndNormal(d[t],90*(3-t),5.5);d[t].set_target_positions(s),e=s[99]}J.get(d[t]).cacheFacing(Y.angleFromTarget(e))}})),t.timeline.addEvent(q+14800,(()=>{for(let t of e)switch(B.debuffs.get(t)){case"1":case"1U":case"1D":let e={x:l(100,1),y:l(92.5,1)};t.set_target_positions([e]),J.get(t).cacheFacing(Y.angleFromTarget(e))}for(let t=0;t<2;t++){let e={x:93+2*t*7,y:92.5};h[t].set_target_positions([e]),J.get(h[t]).cacheFacing(Y.angleFromTarget(e))}for(let t=0;t<3;t++){let e;if(!B.lashes[0]){let s=Y.rotateAndNormal(d[t],90*(3-t),9.5);d[t].set_target_positions([s[99]]),e=s[99],J.get(d[t]).cacheFacing(Y.angleFromTarget(e))}}})),t.timeline.addEvent(q+16800,(()=>{for(let t=0;t<2;t++)null!==h[2]&&J.get(h[t]).cacheFacing(90);for(let t=0;t<3;t++){let e,s=Y.rotateAndNormal(d[t],90*(3-t),5.5);d[t].set_target_positions([s[99]]),e=s[99],J.get(d[t]).cacheFacing(Y.angleFromTarget(e))}})),t.timeline.addEvent(q+18100,(()=>{for(let t=0;t<3;t++){if(1==t)continue;let e={x:93+7*t,y:92.5};n[t].set_target_positions([e]),J.get(n[t]).cacheFacing(Y.angleFromTarget(e))}for(let t=0;t<2;t++){let e={x:l(100,1),y:l(92.5,1)};h[t].set_target_positions([e]),J.get(h[t]).cacheFacing(Y.angleFromTarget(e))}})),t.timeline.addEvent(V+3100,(()=>{for(let t=0;t<3;t++){if(1==t)continue;let e={x:92+8*t,y:92};n[t].set_target_positions([e]),J.get(n[t]).cacheFacing(Y.angleFromTarget(e))}for(let t=0;t<3;t++){let e,s=Y.rotateAndNormal(d[t],90*(3-t),7.5);d[t].set_target_positions([s[99]]),e=s[99],J.get(d[t]).cacheFacing(Y.angleFromTarget(e))}})),t.timeline.addEvent(V+5100,(()=>{for(let t=0;t<3;t++){let e={x:l(100,1),y:l(92.5+(B.lashes[1]?1:-1),.5)};n[t].set_target_positions([e]),J.get(n[t]).cacheFacing(Y.angleFromTarget(e))}for(let t=0;t<2;t++){let e={x:l(100,1),y:l(92.5+(B.lashes[1]?1:-1),.5)};h[t].set_target_positions([e]),J.get(h[t]).cacheFacing(Y.angleFromTarget(e))}})),t.timeline.addEvent(V+6300,(()=>{for(let t of e)"3D"==B.debuffs.get(t)&&J.get(t).cacheFacing(Y.angleFromTarget(t)+180)}));let c=[];t.timeline.addEvent(V+8e3,(()=>{for(let t of e)switch(B.debuffs.get(t)){case"3":case"3U":case"3D":if(B.lashes[1]){let e={x:l(100,1),y:l(94.5,1)};t.set_target_positions([e]),J.get(t).cacheFacing(Y.angleFromTarget(e))}else{let e=Y.rotateAndNormal(t,l(0,5),l(9.5,.5));t.set_target_positions(e),J.get(t).cacheFacing(Y.angleFromTarget(e[99]))}}c=[h[0],n[1],h[1]];for(let t=0;t<3;t++){let e;if(B.lashes[1])e=Y.rotateAndNormal(c[t],90*(3-t),5.5)[99],c[t].set_target_positions([e]);else{let s=Y.rotateAndNormal(c[t],90*(3-t),9.5);c[t].set_target_positions(s),e=s[99]}J.get(c[t]).cacheFacing(Y.angleFromTarget(e))}})),t.timeline.addEvent(V+11700,(()=>{for(let t of e)if(B.lashes[1]){let e=Y.rotateAndNormal(t,l(0,5),l(9.5,.5));t.set_target_positions(e),J.get(t).cacheFacing(Y.angleFromTarget(e[99]))}else{let e={x:l(100,1),y:l(94.5,1)};t.set_target_positions([e]),J.get(t).cacheFacing(Y.angleFromTarget(e))}for(let t=0;t<3;t++){let e;if(B.lashes[1])e=Y.rotateAndNormal(c[t],90*(3-t),9.5)[99],c[t].set_target_positions([e]);else{let s=Y.rotateAndNormal(c[t],90*(3-t),5.5);c[t].set_target_positions(s),e=s[99]}J.get(c[t]).cacheFacing(Y.angleFromTarget(e))}})),t.timeline.addEvent(V+14800,(()=>{for(let t of e){let e={x:l(100,1),y:l(92.5,1)};t.set_target_positions([e]),J.get(t).cacheFacing(Y.angleFromTarget(e))}let s=Y.rotateAndNormal(t.party.T1,45,7.5);t.party.T1.set_target_positions(s),J.get(t.party.T1).cacheFacing(s[99]);for(let t=0;t<3;t++){let e,s=Y.rotateAndNormal(c[t],90*(3-t),9.5);c[t].set_target_positions([s[99]]),e=s[99],J.get(c[t]).cacheFacing(Y.angleFromTarget(e))}})),t.timeline.addEvent(V+16800,(()=>{for(let e=0;e<3;e++){let s,i;i=Object.is(c[e],t.party.T1)?Y.rotateAndNormal(c[e],215,5.5):Y.rotateAndNormal(c[e],90*(3-e),5.5),c[e].set_target_positions([i[99]]),s=i[99],J.get(c[e]).cacheFacing(Y.angleFromTarget(s))}}))}(t),document.getElementById("bgm").play()}}).run();let B={};const j=4500,H=9300,W=17700,q=24800,V=q+21500,Z=V+24300;let Y,J,Q=[];
