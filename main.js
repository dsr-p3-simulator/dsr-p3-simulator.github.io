const t="rgba(255,85,0,0.7)",e=new Set(["KeyW","KeyA","KeyS","KeyD","ArrowUp","ArrowDown","ArrowLeft","ArrowRight"]);let s=new Set;const i=new Set(["Escape","Enter","Space"]),a=[{name:"GamepadA",index:0},{name:"GamepadMenu",index:9}];let r=new Set,n=new Set;function h(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}function o(t,e){for(let s in e)null===e[s]||void 0===e[s]?t.removeAttribute(s):t.setAttribute(s,e[s])}function l(t,e){return t-e+2*e*Math.random()}class u{constructor(t,e,s){this.size=e,this.svg=c("svg"),this.backgroundColor=s;let i=100-e/2;this.svg.setAttribute("viewBox",`${i} ${i} ${e} ${e}`),this.svg.id=t,this.layers={},this.layers.background=this.svg.appendChild(c("g")),o(this.svg.appendChild(c("rect")),{x:""+(i-1),y:""+(i-1),width:`${e+2}`,height:`${e+2}`,fill:this.backgroundColor}),this.layers.arena=this.svg.appendChild(c("g")),this.arenaClipPath=this.svg.appendChild(c("clipPath")),this.arenaClipPath.id=function(t){let e=1,s=t.toString()+"-"+e;for(;document.getElementById(s);)e++,s=t.toString()+e;return s}("xms-arena-clip-path"),this.layers.arenaClippedMechanics=this.svg.appendChild(c("g")),this.layers.arenaClippedMechanics.setAttribute("clip-path",`url(#${this.arenaClipPath.id})`),this.layers.unclippedMechanics=this.svg.appendChild(c("g")),this.layers.enemies=this.svg.appendChild(c("g")),this.layers.dutySupport=this.svg.appendChild(c("g")),this.layers.player=this.svg.appendChild(c("g")),this.layers.partyMemberEffects=this.svg.appendChild(c("g")),this.layers.messages=this.svg.appendChild(c("g")),document.getElementById(t).replaceWith(this.svg)}}function c(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}class g{constructor(){}update(t,e){}addToDrawing(t){}removeFromDrawing(){}allowMovement(t,e){return!0}}class d{#t;#e;constructor(t){this.#t=[],this.#e=t}add(t){return this.#t.push(t),t.addToDrawing(this.#e.drawing),this.#t.length-1}remove(t){for(let[e,s]of this.#t.entries())Object.is(t,s)&&(this.#t[e]=null);t.removeFromDrawing(this.#e.drawing)}update(t,e){for(let s of this.#t)s&&s.update&&s.update(t,e)}allowMovement(t,e){for(let s of this.#t)if(s&&!s.allowMovement(t,e))return!1;return!0}}class p{constructor(t){this.T1=new m("T1","rgb(0,66,197)",1,!1,!1,t),this.H1=new m("H1","rgb(44,197,44)",1,!1,!0,t),this.M1=new m("M1","#f00",1,!0,!1,t),this.R1=new m("R1","#f00",1,!0,!0,t),this.T2=new m("T2","rgb(0,66,197)",2,!1,!1,t),this.H2=new m("H2","rgb(44,197,44)",2,!1,!0,t),this.M2=new m("M2","#f00",2,!0,!1,t),this.R2=new m("R2","#f00",2,!0,!0,t),this.list=[this.T1,this.H1,this.M1,this.R1,this.T2,this.H2,this.M2,this.R2]}reset(){for(let t of this.list)t.reset()}hideDutySupport(){for(let t of this.list)t.player_controlled||t.hide()}showDutySupport(){for(let t of this.list)t.show()}}const f="\n  M-1,-1.25\n  L0,-0.25\n  1,-1.25\n  1.25,-1\n  0.25,0\n  1.25,1\n  1,1.25\n  0,0.25\n  -1,1.25\n  -1.25,1\n  -0.25,0\n  -1.25,-1\n  Z".replaceAll(/\s+/g," ");class m extends g{#s;#i;constructor(t,e,s,i,a,r){super(1),this.label=t,this.color=e,this.KOd=!1,this.isActive=!0,this.lp=s,this.is_dps=i,this.is_ranged=a,this.KO_callback=r,this.target_positions=[],this.player_controlled=!1,this.#s=null}reset(){this.target_positions=[],this.player_controlled=!1,this.layer=1,this.KOd=!1,this.isActive=!0,this.removeFromDrawing()}set_position(t,e){this.x=t,this.y=e}set_target_positions(t){this.target_positions=t}add_target_position(t,e){this.target_positions.push({x:t,y:e})}ko(){if(this.KOd=!0,this.#s){let t=c("path");t.setAttribute("d",f),t.setAttribute("fill","rgba(77,0,0,0.8)"),this.#s.append(t)}}update(t,e){if(this.KOd)return void(this.isActive&&(this.isActive=!1,this.KO_callback()));let i=6*e/1e3;if(this.player_controlled){let e=function(){let t={x:0,y:0};if(s.has("ArrowUp")||s.has("KeyW")?t.y=-1:(s.has("ArrowDown")||s.has("KeyS"))&&(t.y=1),s.has("ArrowRight")||s.has("KeyD")?t.x=1:(s.has("ArrowLeft")||s.has("KeyA"))&&(t.x=-1),0!=t.x||0!=t.y){if(0==t.x||0==t.y)return t;{let e=Math.sqrt(2);return t.x/=e,t.y/=e,t}}if(Navigator.getGamepads)for(let e of Navigator.getGamepads()){if(null===e)continue;if("standard"!=e.mapping)continue;t.x=e.axes[0],t.y=e.axes[1];let s=Math.sqrt(t.x*t.x+t.y*t.y);if(s>=.5)return t.x/=s,t.y/=s,t}return t}(),a=this.x+e.x*i,r=this.y+e.y*i;t.allowMovement({x:e.x,y:e.y},{x:a,y:r})&&(this.x=a,this.y=r)}else{let t=i;for(;this.target_positions.length>0&&t>0;){let e=this.target_positions[0].x-this.x,s=this.target_positions[0].y-this.y,i=Math.sqrt(e*e+s*s);i<=t?(this.x=this.target_positions[0].x,this.y=this.target_positions[0].y,t-=i,this.target_positions.shift()):(this.x+=t*e/i,this.y+=t*s/i,t=0)}}null!==this.#s&&this.#s.setAttribute("transform",`translate(${this.x}, ${this.y})`)}addToDrawing(t){this.#s=c("g"),this.#i&&this.#s.setAttribute("opacity",0);let e=c("circle");e.setAttribute("cx","0"),e.setAttribute("cy","0"),e.setAttribute("r","1.25"),e.setAttribute("fill",this.color),e.setAttribute("stroke-width",.25),e.setAttribute("stroke",this.player_controlled?"#fff":"#000"),this.#s.append(e);let s=c("text");s.textContent=this.label,s.setAttribute("dominant-baseline","central"),s.setAttribute("text-anchor","middle"),s.setAttribute("x","0"),s.setAttribute("y","0"),s.setAttribute("fill","#fff"),s.setAttribute("font-family","monospace"),s.setAttribute("font-size","1.75"),this.#s.append(s),this.#s.setAttribute("transform",`translate(${this.x}, ${this.y})`),this.player_controlled?t.layers.player.append(this.#s):t.layers.dutySupport.append(this.#s)}removeFromDrawing(){null!==this.#s&&(this.#s.remove(),this.#s=null)}hide(){null!==this.#s&&this.#s.setAttribute("opacity",0),this.#i=!0}show(){null!==this.#s&&this.#s.removeAttribute("opacity"),this.#i=!1}}const y="sans-serif";class v extends g{#a;#r;#n;#h;constructor(t,e={x:100,y:100},s=0){super(),this.#a=t,this.#r=e,this.#n=s,this.#h=null}setLocation(t){this.#r=t,this.#o()}setDegreesCWFromN(t){this.#n=t,this.#o()}addToDrawing(t){this.#h=c("path"),this.#h.setAttribute("d","m 0.47070313,-0.01757813 -0.0234375,0.02343751 0.005859,0.0078125 0.015625,-0.01757813 0.0175781,0.01757813 0.007813,-0.0078125 z m -0.94140626,0 -0.0234375,0.02343751 0.007813,0.0078125 0.015625,-0.01562501 0.0175781,0.01562501 0.005859,-0.0078125 z m 0.46783204,-0.42578125 C -0.24644716,-0.44181725 -0.44335937,-0.24393972 -0.44335938,0 c 0,0.12244817 0.0496161,0.23328794 0.12984376,0.31351562 l 0.005332,-0.005332 C -0.38693105,0.22943614 -0.43554687,0.12055663 -0.43554688,0 c 0,-0.24111327 0.19443361,-0.43554687 0.43554688,-0.43554688 0.24111327,0 0.43554687,0.19443361 0.43554688,0.43554688 0,0.12055663 -0.0486158,0.22943614 -0.12736329,0.30818359 l 0.005332,0.005332 C 0.39374331,0.23328793 0.44335937,0.12244817 0.44335938,0 0.44335938,-0.24489635 0.24489635,-0.44335937 0,-0.44335938 c -9.5662635e-4,0 -0.00191589,-6.04e-6 -0.00287109,0 z M 0,-0.50585938 c -0.27884402,0 -0.50585938,0.22701536 -0.50585938,0.50585938 0,0.13942201 0.0567502,0.26589079 0.14835938,0.3575 l 0.007891,-0.007891 C -0.43896446,0.26025429 -0.49414062,0.13671981 -0.49414062,0 c 0,-0.27343963 0.22070099,-0.49414059 0.49414062,-0.49414062 0.27343963,3e-8 0.49414062,0.22070099 0.49414062,0.49414062 0,0.13671981 -0.0551762,0.26025429 -0.14453124,0.34960938 L 0.3575,0.3575 C 0.44910921,0.26589079 0.50585938,0.13942201 0.50585938,0 0.50585938,-0.27884402 0.27884402,-0.50585938 0,-0.50585938 Z M 0,-0.56 a 0.04,0.06 0 0 0 -0.04,0.06 0.04,0.06 0 0 0 1.953e-5,0.001602 A 0.5,0.5 0 0 1 0,-0.5 0.5,0.5 0 0 1 0.03998047,-0.49839844 0.04,0.06 0 0 0 0.04,-0.5 0.04,0.06 0 0 0 0,-0.56 Z"),this.#h.setAttribute("fill","#ff1010"),this.#h.setAttribute("stroke","none"),this.#o(),t.layers.enemies.append(this.#h)}removeFromDrawing(){this.#h&&(this.#h.remove(),this.#h=null)}#o(){this.#h&&this.#h.setAttribute("transform",`translate(${this.#r.x},${this.#r.y}) rotate(${this.#n}) scale(${this.#a})`)}}class x extends g{#l;#u;#c;#g;#d;#p;#s;#f;constructor(t,e){super(0),this.#l=t,this.#u=e,this.#c=0,this.#g=0,this.#d=0,this.#p=0,this.#s=null,this.#f=null}update(t,e){null!==this.#s&&(this.#c+=e,this.#c>=this.#u?this.#g=1:this.#g=this.#c/this.#u,this.#f.setAttribute("width",""+this.#d*this.#g))}addToDrawing(t){this.#d=.75*t.size,this.#p=100-this.#d/2,this.#s=c("g");let e=c("text");e.textContent=this.#l,e.setAttribute("x",`${this.#p}`),e.setAttribute("y",""+(97+t.size/2)),e.setAttribute("fill","#fff"),e.setAttribute("font-family",y),e.setAttribute("font-size","1.5"),this.#s.append(e);let s=""+(98+t.size/2);this.#f=c("rect"),this.#f.setAttribute("x",`${this.#p}`),this.#f.setAttribute("y",s),this.#f.setAttribute("width","0"),this.#f.setAttribute("height","1"),this.#f.setAttribute("fill","rgb(255,189,57)"),this.#s.append(this.#f);let i=this.#f.cloneNode();i.setAttribute("width",`${this.#d}`),i.setAttribute("fill","rgba(0,0,0,0)"),i.setAttribute("stroke-width","0.2"),i.setAttribute("stroke","#fff"),this.#s.append(i),t.layers.messages.append(this.#s)}removeFromDrawing(){null!==this.#s&&(this.#s.remove(),this.#s=null,this.#f=null)}}class b extends g{#l;#m;constructor(t){super(),this.#l=t,this.#m=null}addToDrawing(t){this.#m=c("text"),this.#m.textContent=this.#l,this.#m.setAttribute("text-anchor","middle"),this.#m.setAttribute("x","100"),this.#m.setAttribute("y",""+(104-t.size/2)),this.#m.setAttribute("fill","#fff"),this.#m.setAttribute("font-family",y),this.#m.setAttribute("font-size","2"),t.layers.messages.append(this.#m)}removeFromDrawing(){null!==this.#m&&(this.#m.remove(),this.#m=null)}}class w extends g{#s;constructor(){super(),this.#s=null}addToDrawing(t){this.#s=c("g");let e=c("rect");this.#s.append(e);let s=c("text");s.textContent="Success!",o(s,{"text-anchor":"middle","dominant-baseline":"central",x:"100",y:"100",fill:"#fff","font-family":y,"font-size":"5"}),this.#s.append(s),t.layers.messages.append(this.#s);let i=s.getBBox();o(e,{x:""+(i.x-1.3),y:""+(i.y-.6),width:`${i.width+2.6}`,height:`${i.height+1.2}`,fill:"rgba(0,0,0,0.8)",rx:"1",ry:"1",filter:"blur(0.1)"})}removeFromDrawing(){null!==this.#s&&(this.#s.remove(),this.#s=null)}}class A extends g{#y=null;#s;constructor(t){super(1),this.#y=t,this.#s=null}addToDrawing(t){if(this.#s=c("g"),null!==this.#y){let e=c("rect");e.setAttribute("x",""+(100-t.size/2)),e.setAttribute("y",""+(95+t.size/2)),e.setAttribute("width",`${t.size}`),e.setAttribute("height","6"),e.setAttribute("fill",this.#y),this.#s.append(e)}let e=c("text");e.textContent="Press SPACE or ENTER or gamepad A to restart",e.setAttribute("text-anchor","middle"),e.setAttribute("x","100"),e.setAttribute("y",""+(97+t.size/2)),e.setAttribute("fill","#fff"),e.setAttribute("font-family",y),e.setAttribute("font-size","1.5"),this.#s.append(e);let s=e.cloneNode();s.textContent="Press ESC or the gamepad menu button to change settings",s.setAttribute("y",""+(99+t.size/2)),this.#s.append(s),t.layers.messages.append(this.#s)}removeFromDrawing(){null!==this.#s&&(this.#s.remove(),this.#s=null)}}class _ extends g{#v;#d;#x;#b;#w;#A;constructor(t,e=3.2,s=1.6){super(1),this.#v=t,this.#d=e,this.#x=this.#d/8,this.#b=(this.#d-this.#x)/3,this.#w=-1*s-this.#x/2,this.#A=new Map}update(){this.#A.forEach(((t,e,s)=>{e.setAttribute("transform",`translate(${t.x},${t.y})`)}))}addToDrawing(t){this.#v.forEach(((e,s,i)=>{let a=null,r=this.#w,n=r-this.#b,h=r-this.#b/2;switch(e){case 1:a=[{x:0,y:h}];break;case 2:a=[{x:0-this.#b/2,y:h},{x:this.#b/2,y:h}];break;case 3:a=[{x:0-this.#b/2,y:r},{x:this.#b/2,y:r},{x:0,y:n}];break;case 4:a=[{x:0-this.#b/2,y:r},{x:this.#b/2,y:r},{x:0-this.#b/2,y:n},{x:this.#b/2,y:n}];break;case 5:a=[{x:0-this.#b/2,y:h},{x:this.#b/2,y:n},{x:this.#b/2,y:r},{x:3*this.#b/2,y:n},{x:3*this.#b/2,y:r}];break;case 6:a=[{x:0-this.#b,y:n},{x:0-3*this.#b/2,y:r},{x:0-this.#b/2,y:r},{x:this.#b,y:r},{x:3*this.#b/2,y:n},{x:this.#b/2,y:n}];break;case 7:a=[{x:0-this.#b,y:n},{x:0-3*this.#b/2,y:r},{x:0-this.#b/2,y:r},{x:3*this.#b/2,y:n},{x:this.#b/2,y:n},{x:3*this.#b/2,y:r},{x:this.#b/2,y:r}];break;case 8:a=[{x:0-3*this.#b/2,y:n},{x:0-this.#b/2,y:n},{x:0-3*this.#b/2,y:r},{x:0-this.#b/2,y:r},{x:3*this.#b/2,y:n},{x:this.#b/2,y:n},{x:3*this.#b/2,y:r},{x:this.#b/2,y:r}]}let o=e%2?"#dae8fc":"#ffeaff",l=e%2?"#97c1fc":"#fcaefc",u=c("g");for(const t of a){let e=c("circle");e.setAttribute("cx",t.x),e.setAttribute("cy",t.y),e.setAttribute("r",this.#x),e.setAttribute("fill",o),e.setAttribute("stroke-width",this.#x/8),e.setAttribute("stroke",l),u.append(e)}u.setAttribute("transform",`translate(${s.x},${s.y})`),t.layers.partyMemberEffects.append(u),this.#A.set(u,s)}))}removeFromDrawing(){this.#A.forEach(((t,e,s)=>{e.remove()})),this.#A.clear()}}class T extends g{#_;#T;#c;#M;constructor(){super(),this.#_=[],this.#T=null,this.#c=0,this.#M=!1}addEvent(t,e){this.#_.push({time:t,fn:e}),this.#M&&(this.#$(),t<=this.#c&&(e(),this.#T++))}#$(){this.#_.sort(((t,e)=>t.time-e.time))}start(){this.#_.length>0&&(this.#$(),this.#T=0,this.#c=0,this.#M=!0)}pause(){this.#M=!1}update(t,e){if(this.#M){for(this.#c+=e;this.#T<this.#_.length&&this.#_[this.#T].time<=this.#c;)this.#_[this.#T].fn(),this.#T++;this.#T>=this.#_.length&&(this.#M=!1)}}}
/* @license
License for the xiv-mech-sim library

Copyright 2023 Jen Pollock

Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the “Software”), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
*/class M extends g{#a;#F;#p;#E;#k;#G;#R;constructor(t,e,s){super(-1),this.#a=e,this.#F=s,this.#p=100-e/2,this.#E=100+e/2,this.#k=100-e/2,this.#G=100+e/2,this.#R=null}update(t,e){for(let e of t.party.list)(e.x<this.#p||e.x>this.#E||e.y<this.#k||e.y>this.#G)&&e.ko()}addToDrawing(t){this.#R=c("rect"),this.#R.setAttribute("x",`${this.#p}`),this.#R.setAttribute("y",`${this.#k}`),this.#R.setAttribute("width",`${this.#a}`),this.#R.setAttribute("height",`${this.#a}`),this.#R.setAttribute("fill",this.#F),t.layers.arena.append(this.#R),t.arenaClipPath.append(this.#R.cloneNode())}removeFromDrawing(){this.#R&&(this.#R.remove(),this.#R=null,drawing.arenaClipPath.replaceChildren())}}class $ extends v{#s;#S;facing;target;targetLoc;#R;constructor(t){super(4,t),this.#S=!0,this.facing=0,this.target=t}update(t,e){super.update(t,e);let s,i=Number.POSITIVE_INFINITY;for(let e of t.party.list){let t=h(e,this.target);t<i&&(i=t,s=e)}let a=180/Math.PI*(Math.PI/2+Math.atan2(s.y-this.target.y,s.x-this.target.x));this.#S||(super.setDegreesCWFromN(a),this.facing=a*Math.PI/180,this.targetLoc={x:s.x,y:s.y})}angleTo(t){return Math.PI/2+Math.atan2(t.y-100,t.x-100)}castlock(){this.#S=!0}removeCastlock(){this.#S=!1}addToDrawing(t){super.addToDrawing(t),this.#s=c("g"),t.layers.arenaClippedMechanics.append(this.#s)}removeFromDrawing(t){super.removeFromDrawing(t),this.#s.remove()}hit(t){let e=c("rect");e.setAttribute("x",""+(this.target.x-4)),e.setAttribute("y",""+(this.target.y-100)),e.setAttribute("width","8"),e.setAttribute("height","100"),e.setAttribute("fill","rgba(140,40,0,0.8)"),e.setAttribute("transform",`rotate(${180/Math.PI*this.facing} ${this.target.x} ${this.target.y})`),this.#s.append(e);for(let e of t)"T1"!=e.label&&Math.abs((this.targetLoc.x-this.target.x)*(this.target.y-e.y)-(this.target.x-e.x)*(this.targetLoc.y-this.target.y))/Math.hypot(this.targetLoc.x-this.target.x,this.targetLoc.y-this.target.y)<4&&Math.cos(Math.atan2(this.targetLoc.y-this.target.y,this.targetLoc.x-this.target.x)-Math.atan2(e.y-this.target.y,e.x-this.target.x))>0&&e.ko()}}class F extends g{#C;#D;#I;#P;#N;color;#z;constructor(t,e="#3DAEFF"){super(),this.#I=t,this.#C=0,this.#D={x:t.x??100,y:t.y+1??100},this.color=e,this.#N=!1,this.#z=null}update(t,e){super.update(t,e),this.#I.x!=this.#D.x||this.#I.y!=this.#D.y?(this.#C=180/Math.PI*(Math.PI/2+Math.atan2(this.#I.y-this.#D.y,this.#I.x-this.#D.x)),this.#P.setAttribute("d",`M ${this.#I.x-.5} ${this.#I.y-1.5} h 1 l -0.5 ${-Math.sqrt(3)/2} Z`),this.#P.setAttribute("transform",`rotate(${this.#C} ${this.#I.x} ${this.#I.y})`),this.#D={x:this.#I.x,y:this.#I.y}):null===this.#z||this.#I.player_controlled||0!=this.#I.target_positions.length||(this.#C=this.#z,this.#P.setAttribute("transform",`rotate(${this.#C} ${this.#I.x} ${this.#I.y})`),this.#z=null)}addToDrawing(t){this.#P=c("path"),this.#P.setAttribute("d",`M ${this.#I.x-.5} ${this.#I.y-1.5} h 1 l 0 ${-1.5-Math.sqrt(3)/2} Z`),this.#P.setAttribute("fill",this.color),this.#P.setAttribute("fill-opacity",this.#N?"1":"0"),this.#P.setAttribute("transform",`rotate(${this.#C} ${this.#I.x} ${this.#I.y})`),this.#I.player_controlled?t.layers.player.append(this.#P):t.layers.dutySupport.append(this.#P)}removeFromDrawing(t){this.#P&&(this.#P.remove(),this.#P=null)}setVisible(t){this.#N=t,this.#P.setAttribute("fill-opacity",this.#N?"1":"0")}cacheFacing(t){this.#z=t}dropTower(t){return{x:this.#I.x+15*t*Math.cos((this.#C-90)*Math.PI/180),y:this.#I.y+15*t*Math.sin((this.#C-90)*Math.PI/180)}}}class E extends g{#s;constructor(t){super(),this.#s=null}addToDrawing(t){this.#s=c("g"),t.layers.arenaClippedMechanics.append(this.#s)}removeFromDrawing(){this.#s&&(this.#s.remove(),this.#s=null)}hit(t){let e=Math.PI/2+Math.atan2(t.T1.y-100,t.T1.x-100),s=c("rect");s.setAttribute("x","99"),s.setAttribute("y","50"),s.setAttribute("width","2"),s.setAttribute("height","50"),s.setAttribute("fill","rgba(140,40,0,0.8)"),s.setAttribute("transform",`rotate(${180/Math.PI*e} 100 100)`),this.#s.append(s);let i=t.T1;for(let e of t.list)"T1"!=e.label&&Math.abs((i.x-100)*(100-e.y)-(100-e.x)*(i.y-100))/Math.hypot(i.x-100,i.y-100)<1&&Math.cos(Math.atan2(i.y-100,i.x-100)-Math.atan2(e.y-100,e.x-100))>0&&e.ko()}}class k extends g{#s;#L;target;#h;#R;constructor(t){super(),this.#s=null;let e={hit_color:"rgba(5,5,43,0.7)",miss_color:"rgba(140,40,0,0.8)",tower_color:"rgba(120,82,18,0.7)",radius:5,soakCount:1,...t};this.outerRadius=e.radius,this.innerRadius=this.outerRadius-1,this.#L=e.soakCount,this.warning_color=e.tower_color,this.hit_color=e.hit_color,this.miss_color=e.miss_color,this.target=e.target}addToDrawing(t){this.#s=c("g"),this.#h=c("path"),this.#h.setAttribute("d",`M0,-${this.outerRadius}\n    A${this.outerRadius} ${this.outerRadius} 0 0 1 0,${this.outerRadius}\n    A${this.outerRadius} ${this.outerRadius} 0 0 1 0,-${this.outerRadius}\n    M0,-${this.innerRadius}\n    A${this.innerRadius} ${this.innerRadius} 0 0 0 0,${this.innerRadius}\n    A${this.innerRadius} ${this.innerRadius} 0 0 0 0,-${this.innerRadius}`),this.#h.setAttribute("fill",this.has_hit?this.hit_color:this.warning_color),this.#h.setAttribute("transform",`translate(${this.target.x},${this.target.y})`),this.#R=c("rect"),this.#R.setAttribute("x",""+(this.target.x-.5)),this.#R.setAttribute("y",""+(this.target.y-10)),this.#R.setAttribute("width","1"),this.#R.setAttribute("height","10"),this.#R.setAttribute("fill",this.has_hit?this.hit_color:this.warning_color),this.#s.append(this.#h),this.#s.append(this.#R),t.layers.arenaClippedMechanics.append(this.#s)}removeFromDrawing(){null!==this.#h&&(this.#h.remove(),this.#h=null),null!==this.#s&&(this.#s.remove(),this.#s=null),null!==this.#R&&(this.#R.remove(),this.#R=null)}hit(t){let e=[];for(let s of t)Object.is(s,this.target)||h(s,this.target)<=this.outerRadius&&e.push(s);let s=e.length>=this.#L;if(!s)for(let e of t)e.ko();return this.has_hit=!0,null!==this.#h&&(this.innerRadius=0,this.#h.setAttribute("d",`M0,-${this.outerRadius}\n        A${this.outerRadius} ${this.outerRadius} 0 0 1 0,${this.outerRadius}\n        A${this.outerRadius} ${this.outerRadius} 0 0 1 0,-${this.outerRadius}\n        M0,-${this.innerRadius}\n        A${this.innerRadius} ${this.innerRadius} 0 0 0 0,${this.innerRadius}\n        A${this.innerRadius} ${this.innerRadius} 0 0 0 0,-${this.innerRadius}`),this.#h.setAttribute("fill",s?this.hit_color:this.miss_color)),null!==this.#R&&(this.#R.remove(),this.#R=null),this.target={x:this.target.x,y:this.target.y},e}}class G extends v{#S;facing;constructor(){super(15),this.#S=!1}update(t,e){super.update(t,e);let s=180/Math.PI*(Math.PI/2+Math.atan2(t.party.T1.y-100,t.party.T1.x-100));this.#S||(super.setDegreesCWFromN(s),this.facing=s*Math.PI/180)}angleToMT(t){return Math.PI/2+Math.atan2(t.party.T1.y-100,t.party.T1.x-100)}castlock(){this.#S=!0}removeCastlock(){this.#S=!1}autoAttack(t,e){let s=new E;t.timeline.addEvent(e,(()=>{t.entities.add(s),s.hit(t.party)})),t.timeline.addEvent(e+300,(()=>{t.entities.remove(s)}))}angleFromTarget(t){return 180/Math.PI*(Math.PI/2+Math.atan2(100-t.y,100-t.x))}rotateAndNormal(t,e,s){let i=Math.hypot(t.x-100,t.y-100),a=Math.atan2(t.y-100,t.x-100),r=(e-90)*Math.PI/180;return r-a>Math.PI?a+=2*Math.PI:r-a<-Math.PI&&(a-=2*Math.PI),Array(100).fill(0).map(((t,e)=>{let n=i+(e+1)/100*(s-i),h=a+(e+1)/100*(r-a);return{x:100+n*Math.cos(h),y:100+n*Math.sin(h)}}))}}class R extends M{#O;constructor(t){super(t,40,"#b0befc")}addToDrawing(t){super.addToDrawing(t),this.#O=c("image"),this.#O.setAttribute("x","80"),this.#O.setAttribute("y","80"),this.#O.setAttribute("width","40"),this.#O.setAttribute("height","40"),this.#O.setAttribute("href","dsu-p3-cropped.png"),t.layers.arena.append(this.#O)}}class S extends g{#U;constructor(t){let e={hit_color:"rgba(5,5,43,0.7)",...t};super(0),this.targets=e.targets,this.soak_count=e.soak_count,this.radius=e.radius,this.color=e.color,this.hit_color=e.hit_color,this.hasHit=!1,this.#U=[]}hit(t){let e=[],s=[];for(let i of this.targets){let a={x:i.x,y:i.y},r=[];for(let s of t)s.isActive&&h(s,a)<this.radius&&(r.push(s),e.includes(s)?s.ko():e.push(s));if(r.length<this.soak_count)for(let t of r)t.ko();s.push(a)}this.targets=s;for(let t of this.#U)t.setAttribute("fill",this.hit_color),t.setAttribute("stroke","transparent");this.hasHit=!0}update(){let t=0;for(let e of this.targets)this.#U[t].setAttribute("cx",`${e.x}`),this.#U[t].setAttribute("cy",`${e.y}`),t++}addToDrawing(t){let e=this.color,s="transparent";this.hasHit&&(s=this.hit_color,e="transparent");for(const i of this.targets){let a=c("circle");a.setAttribute("cx",`${i.x}`),a.setAttribute("cy",`${i.y}`),a.setAttribute("r",`${this.radius}`),a.setAttribute("fill",s),a.setAttribute("stroke-width",.25),a.setAttribute("stroke",e),this.#U.push(a),t.layers.arenaClippedMechanics.append(a)}}removeFromDrawing(){for(let t of this.#U)t.remove();this.#U=[]}}class C extends g{#K;constructor(e){let s={...{hit_color:"rgba(5,5,43,0.7)",warning_color:t},...e};super(0),this.target=s.target,this.radius=s.radius,this.warning_color=s.warning_color,this.hit_color=s.hit_color,this.has_hit=!1,this.#K=null}hit(t){for(let e of t)Object.is(e,this.target)||h(e,this.target)<=this.radius&&e.ko();this.has_hit=!0,null!==this.#K&&this.#K.setAttribute("fill",this.hit_color),this.target={x:this.target.x,y:this.target.y}}update(){null!==this.#K&&this.#K.setAttribute("transform",`translate(${this.target.x},${this.target.y})`)}addToDrawing(t){this.#K=c("circle"),this.#K.setAttribute("cx","0"),this.#K.setAttribute("cy","0"),this.#K.setAttribute("r",`${this.radius}`),this.#K.setAttribute("fill",this.has_hit?this.hit_color:this.warning_color),this.#K.setAttribute("transform",`translate(${this.target.x},${this.target.y})`),t.layers.arenaClippedMechanics.append(this.#K)}removeFromDrawing(){null!==this.#K&&(this.#K.remove(),this.#K=null)}}class D extends g{#h;constructor(e){let s={...{hit_color:"rgba(5,5,43,0.7)",warning_color:t},...e};super(0),this.target=s.target,this.innerRadius=s.inner_radius,this.outerRadius=s.outer_radius,this.warning_color=s.warning_color,this.hit_color=s.hit_color,this.has_hit=!1,this.#h=null}hit(t){for(let e of t){if(Object.is(e,this.target))continue;let t=h(e,this.target);t>this.innerRadius&&t<=this.outerRadius&&e.ko()}this.has_hit=!0,null!==this.#h&&this.#h.setAttribute("fill",this.hit_color),this.target={x:this.target.x,y:this.target.y}}update(){null!==this.#h&&this.#h.setAttribute("transform",`translate(${this.target.x},${this.target.y})`)}addToDrawing(t){this.#h=c("path"),this.#h.setAttribute("d",`M0,-${this.outerRadius}\n    A${this.outerRadius} ${this.outerRadius} 0 0 1 0,${this.outerRadius}\n    A${this.outerRadius} ${this.outerRadius} 0 0 1 0,-${this.outerRadius}\n    M0,-${this.innerRadius}\n    A${this.innerRadius} ${this.innerRadius} 0 0 0 0,${this.innerRadius}\n    A${this.innerRadius} ${this.innerRadius} 0 0 0 0,-${this.innerRadius}`),this.#h.setAttribute("fill",this.has_hit?this.hit_color:this.warning_color),this.#h.setAttribute("transform",`translate(${this.target.x},${this.target.y})`),t.layers.arenaClippedMechanics.append(this.#h)}removeFromDrawing(){null!==this.#h&&(this.#h.remove(),this.#h=null)}}new class{#B;#M;#j;#H;#W;#q;#V;constructor(t){this.#j=t.placeholderId,this.#H=t.drawingSize,this.backgroundColor=t.backgroundColor,this.#W=document.getElementById(t.menuId),this.entities=null,this.timeline=null,this.#B=null,this.#M=!1,this.#q=0,this.#V=t.initFn}run(){window.addEventListener("keydown",(t=>{e.has(t.code)&&s.add(t.code)})),window.addEventListener("keyup",(t=>{s.delete(t.code),i.has(t.code)&&n.add(t.code)})),document.getElementById("start").addEventListener("click",(t=>{this.startPull()})),this.#W.addEventListener("cancel",(t=>{this.startPull()})),this.#W.showModal()}startPull(){this.drawing=new u(this.#j,this.#H,this.backgroundColor),this.party=new p((()=>this.endRun())),this.entities=new d(this),this.timeline=new T,this.entities.add(this.timeline),this.#V(this);for(let t of this.party.list)document.querySelector(`input[type="radio"][name="player"][value="${t.label}"]`).checked&&(t.player_controlled=!0,t.show(),t.layer=2,this.player=t),this.entities.add(t);null!==this.#B&&clearInterval(this.#B),this.#q=Date.now(),this.#B=setInterval((()=>this.update()),1e3/60),this.timeline.start(),this.#M=!0}update(){let t=this.drawing.svg.suspendRedraw(1e3/60),e=Date.now(),s=e-this.#q;this.#q=e,function(){if(Navigator.getGamepads)for(let t of Navigator.getGamepads())for(let e of a)t.buttons[e.index].pressed?r.add(e.name):r.has(e.name)&&(r.delete(e.name),n.add(e.name),console.log(n))}(),this.#M?this.entities.update(this,s):this.#W.open||((n.has("Escape")||n.has("GamepadMenu"))&&(n.delete("Escape"),n.delete("GamepadMenu"),1)?this.#W.showModal():(n.has("Space")||n.has("Enter")||n.has("GamepadA"))&&(n.delete("Space"),n.delete("Enter"),n.delete("GamepadA"),1)&&this.startPull()),this.drawing.svg.unsuspendRedraw(t)}endRun(){this.#M=!1,this.entities.add(new A(this.backgroundColor)),n.clear()}allowMovement(t,e){return this.entities.allowMovement(t,e)}}({placeholderId:"sim",drawingSize:50,backgroundColor:"#00072b",menuId:"menu",initFn:function(t){!function(t){let e=t.party.list.slice();const s=Math.floor(7*Math.random());let i=["1","3"];for(let t=1;t<=3;t++)2>>t-1&s?(i.push(`${t}U`),i.push(`${t}D`)):(i.push(`${t}`),i.push(`${t}`));console.log(i),I.debuffs=new Map;for(let t=0;t<8;t++){let s=Math.floor(Math.random()*e.length);I.debuffs.set(e[s],i[t]),e.splice(s,1)}I.lashes=[Math.random()>.5,Math.random()>.5],console.log(JSON.stringify(I))}(t),t.entities.add(new R(t)),document.getElementById("bgm").pause(),document.getElementById("bgm").volume=parseInt(document.getElementById("volume-slider").value)/100,document.getElementById("bgm").currentTime=0,function(t){B=new Map;let e=!1;t.timeline.addEvent(1,(()=>{for(let s of t.party.list){let i=new F(s);B.set(s,i),t.entities.add(i),s.player_controlled&&(i.setVisible(!0),e=!0)}if(!e)for(let[t,e]of B)e.setVisible(!0)})),K=new G;let s=new b("Thy final verse is sung!"),i=new b("Thou hast survived my song..."),a=new b("Curse thee and thine eye, Hraesvelgr!");t.timeline.addEvent(P,(()=>{t.entities.add(K),t.entities.add(s)})),t.timeline.addEvent(N,(()=>{t.entities.remove(s),t.entities.add(i)})),K.autoAttack(t,N),t.timeline.addEvent(N+3e3,(()=>{t.entities.remove(i),t.entities.add(a)})),K.autoAttack(t,N+3e3),t.timeline.addEvent(N+6e3,(()=>{t.entities.remove(a)})),K.autoAttack(t,N+6e3);let r=new Map;for(let[t,e]of I.debuffs)r.set(t,e.charCodeAt(0)-48);let n=new _(r),h=new x("Dive From Grace",4700);t.timeline.addEvent(z,(()=>{t.entities.add(h),t.entities.add(n),K.castlock()})),t.timeline.addEvent(z+4800,(()=>{t.entities.remove(h),t.entities.remove(n)}));let o=new x(I.lashes[0]?"Lash and Gnash":"Gnash and Lash",7300);t.timeline.addEvent(L,(()=>{t.entities.add(o)}));let l,u=[];for(let e of t.party.list)I.debuffs.get(e).startsWith("1")&&u.push(new C({target:e,radius:5}));t.timeline.addEvent(L+7400,(()=>{t.entities.remove(o);let e=[];for(let s of u){switch(t.entities.add(s),I.debuffs.get(s.target)){case"1":j.push(B.get(s.target).dropTower(0));break;case"1U":j.push(B.get(s.target).dropTower(1));break;case"1D":j.push(B.get(s.target).dropTower(-1))}e.push(s.target),s.hit(t.party.list)}let s,i=[100+7.5*Math.sin(K.facing),100-7.5*Math.cos(K.facing)],a=Number.POSITIVE_INFINITY;for(let e of t.party.list){let t=Math.hypot(e.x-i[0],e.y-i[1]);t<a&&(a=t,s=e)}l=new S({targets:[s],soak_count:5,radius:5}),t.entities.add(l),l.hit(t.party.list);for(let t of e)(Object.is(s,t)||Math.hypot(s.x-t.x,s.y-t.y)<5)&&s.ko()})),t.timeline.addEvent(L+7800,(()=>{for(let e of u)t.entities.remove(e);t.entities.remove(l)}));let c=new C({target:{x:100,y:100},radius:7.5}),g=new D({target:{x:100,y:100},inner_radius:7.5,outer_radius:80});t.timeline.addEvent(L+11300,(()=>{I.lashes[0]?(t.entities.add(g),g.hit(t.party.list)):(t.entities.add(c),c.hit(t.party.list)),j=j.map((e=>{let s=new k({target:e});return t.entities.add(s),s}))})),t.timeline.addEvent(L+11700,(()=>{I.lashes[0]?t.entities.remove(g):t.entities.remove(c)})),t.timeline.addEvent(L+14400,(()=>{I.lashes[0]?(t.entities.add(c),c.hit(t.party.list)):(t.entities.add(g),g.hit(t.party.list));for(let e of j)e.hit(t.party.list)}));let d=[];t.timeline.addEvent(L+14800,(()=>{I.lashes[0]?t.entities.remove(c):t.entities.remove(g);for(let e of j){t.entities.remove(e);let s=new $(e.target);d.push(s),t.entities.add(s)}})),t.timeline.addEvent(L+16600,(()=>{for(let t of d)t.removeCastlock()})),t.timeline.addEvent(L+16800,(()=>{for(let t of d)t.castlock()}));let p=[];for(let e of t.party.list)I.debuffs.get(e).startsWith("2")&&p.push(new C({target:e,radius:5}));t.timeline.addEvent(L+17500,(()=>{let e=[];j=[];for(let s of p){switch(t.entities.add(s),I.debuffs.get(s.target)){case"2":j.push(B.get(s.target).dropTower(0));break;case"2U":j.push(B.get(s.target).dropTower(1));break;case"2D":j.push(B.get(s.target).dropTower(-1))}e.push(s.target),s.hit(t.party.list)}})),t.timeline.addEvent(L+17900,(()=>{for(let e of p)t.entities.remove(e)})),t.timeline.addEvent(L+21200,(()=>{for(let e of d)e.hit(t.party.list)}));let f,m=new x(I.lashes[1]?"Lash and Gnash":"Gnash and Lash",7300);t.timeline.addEvent(O,(()=>{t.entities.add(m)})),t.timeline.addEvent(O+200,(()=>{j=j.map((e=>{let s=new k({target:e});return t.entities.add(s),s}));for(let e of d)t.entities.remove(e)})),t.timeline.addEvent(O+2400,(()=>{for(let e of j)e.hit(t.party.list)})),t.timeline.addEvent(O+2800,(()=>{d=[];for(let e of j){t.entities.remove(e);let s=new $(e.target);d.push(s),t.entities.add(s)}})),t.timeline.addEvent(O+4600,(()=>{for(let t of d)t.removeCastlock()})),t.timeline.addEvent(O+4800,(()=>{for(let t of d)t.castlock()})),j=[];let y=[];for(let e of t.party.list)I.debuffs.get(e).startsWith("3")&&y.push(new C({target:e,radius:5}));t.timeline.addEvent(O+7400,(()=>{t.entities.remove(m);let e=[];j=[];for(let s of y){switch(t.entities.add(s),I.debuffs.get(s.target)){case"3":j.push(B.get(s.target).dropTower(0));break;case"3U":j.push(B.get(s.target).dropTower(1));break;case"3D":j.push(B.get(s.target).dropTower(-1))}e.push(s.target),s.hit(t.party.list)}let s,i=[100+7.5*Math.sin(K.facing),100-7.5*Math.cos(K.facing)],a=Number.POSITIVE_INFINITY;for(let e of t.party.list){let t=Math.hypot(e.x-i[0],e.y-i[1]);t<a&&(a=t,s=e)}f=new S({targets:[s],soak_count:5,radius:5}),t.entities.add(f),f.hit(t.party.list);for(let t of e)(Object.is(s,t)||Math.hypot(s.x-t.x,s.y-t.y)<5)&&s.ko()})),t.timeline.addEvent(O+7800,(()=>{for(let e of y)t.entities.remove(e);t.entities.remove(f)})),t.timeline.addEvent(O+9600,(()=>{for(let e of d)e.hit(t.party.list)})),t.timeline.addEvent(O+10100,(()=>{for(let e of d)t.entities.remove(e)}));let v=new C({target:{x:100,y:100},radius:7.5}),A=new D({target:{x:100,y:100},inner_radius:7.5,outer_radius:80});t.timeline.addEvent(O+11300,(()=>{I.lashes[1]?(t.entities.add(A),A.hit(t.party.list)):(t.entities.add(v),v.hit(t.party.list)),j=j.map((e=>{let s=new k({target:e});return t.entities.add(s),s}))})),t.timeline.addEvent(O+11700,(()=>{I.lashes[1]?t.entities.remove(A):t.entities.remove(v)})),t.timeline.addEvent(O+14400,(()=>{I.lashes[1]?(t.entities.add(v),v.hit(t.party.list)):(t.entities.add(A),A.hit(t.party.list));for(let e of j)e.hit(t.party.list)})),t.timeline.addEvent(O+14800,(()=>{I.lashes[1]?t.entities.remove(v):t.entities.remove(A),d=[];for(let e of j){t.entities.remove(e);let s=new $(e.target);d.push(s),t.entities.add(s)}})),t.timeline.addEvent(O+16600,(()=>{for(let t of d)t.removeCastlock()})),t.timeline.addEvent(O+16800,(()=>{for(let t of d)t.castlock()})),t.timeline.addEvent(O+18500,(()=>{K.removeCastlock()})),K.autoAttack(t,O+18500),t.timeline.addEvent(O+20800,(()=>{for(let e of d)e.hit(t.party.list)})),t.timeline.addEvent(O+21300,(()=>{for(let e of d)t.entities.remove(e)})),K.autoAttack(t,O+21500),t.timeline.addEvent(U,(()=>{t.entities.add(new w),t.endRun()}))}(t),function(t){let e=t.party.list;for(let t of e)t.set_position(l(100,.5),l(105,.5));t.party.T1.set_position(100,92.5),t.timeline.addEvent(P+500,(()=>{let s=[];for(let i of e){if(Object.is(i,t.party.T1))continue;let e,a=!1;for(;!a;){a=!0,e=Math.random()*Math.PI+Math.PI/2;for(let t of s)Math.abs(e-t)<Math.PI/12&&(a=!1)}s.push(e);let r={x:l(100+7.5*Math.sin(e),.3),y:l(100-7.5*Math.cos(e),.3)};i.set_target_positions([r]),B.get(i).cacheFacing(K.angleFromTarget(r))}}));let s,i,a,r=[],n=Array(3).fill(null),h=[],o=Array(3).fill(null),u=[],c=Array(3).fill(null);t.timeline.addEvent(z+700,(()=>{for(let t of e){let e=I.debuffs.get(t);switch(e){case"1U":n[0]=t,r.push(t);break;case"1D":n[2]=t,r.push(t);break;case"1":n[1]=t,r.push(t);break;case"2U":o[0]=t,h.push(t);break;case"2D":o[2]=t,h.push(t);break;case"2":o[1]=t,h.push(t);break;case"3U":c[0]=t,u.push(t);break;case"3D":c[2]=t,u.push(t);break;case"3":c[1]=t,u.push(t);break;default:console.error(`Recieved invalid debuff ${e}`)}}r.sort(((t,e)=>t.x-e.x)),s=[{x:92.5,y:100},{x:100,y:107.5},{x:107.5,y:100}];for(let t=0;t<3;t++)r[t].set_target_positions([s[t]]),B.get(r[t]).cacheFacing(K.angleFromTarget(s[t])),Object.is(n[2],null)&&(n[t]=r[t]);u.sort(((t,e)=>t.x-e.x)),a=[{x:95,y:100},{x:100,y:105},{x:105,y:100}];for(let t=0;t<3;t++)u[t].set_target_positions([a[t]]),B.get(u[t]).cacheFacing(K.angleFromTarget(a[t])),Object.is(c[2],null)&&(c[t]=u[t]);h.sort(((t,e)=>t.x-e.x)),i=[{x:98,y:94},{x:102,y:94}];for(let t=0;t<2;t++)h[t].set_target_positions([i[t]]),B.get(h[t]).cacheFacing(K.angleFromTarget(i[t])),Object.is(o[2],null)&&(o[t]=h[t]);o[1]??=o[2],console.log(n,o,c)})),t.timeline.addEvent(L+700,(()=>{for(let t=0;t<3;t++)n[t].set_target_positions([s[t]]),B.get(n[t]).cacheFacing(K.angleFromTarget(s[t]));for(let t of e)switch(I.debuffs.get(t)){case"2":case"2U":case"2D":case"3":case"3U":case"3D":let e={x:l(100,.5),y:l(92.5+(I.lashes[0]?1:-1),.5)};t.set_target_positions([e]),B.get(t).cacheFacing(K.angleFromTarget(e))}})),t.timeline.addEvent(L+6300,(()=>{for(let t of e)"1D"==I.debuffs.get(t)&&B.get(t).cacheFacing(K.angleFromTarget(t)+180)})),t.timeline.addEvent(L+8e3,(()=>{for(let t of e)switch(I.debuffs.get(t)){case"1":case"1U":case"1D":if(I.lashes[0]){let e={x:l(100,1),y:l(94.5,1)};t.set_target_positions([e]),B.get(t).cacheFacing(K.angleFromTarget(e))}else{let e=K.rotateAndNormal(t,l(0,5),l(9.5,.5));t.set_target_positions(e),B.get(t).cacheFacing(K.angleFromTarget(e[99]))}}for(let t=0;t<3;t++){let e;if(I.lashes[0])e=K.rotateAndNormal(c[t],90*(3-t),5.5)[99],c[t].set_target_positions([e]);else{let s=K.rotateAndNormal(c[t],90*(3-t),9.5);c[t].set_target_positions(s),e=s[99]}B.get(c[t]).cacheFacing(K.angleFromTarget(e))}})),t.timeline.addEvent(L+11700,(()=>{for(let t of e)switch(I.debuffs.get(t)){case"1":case"1U":case"1D":case"2":case"2U":case"2D":if(I.lashes[0]){let e=K.rotateAndNormal(t,l(0,5),l(9.5,.5));t.set_target_positions(e),B.get(t).cacheFacing(K.angleFromTarget(e[99]))}else{let e={x:l(100,1),y:l(94.5,1)};t.set_target_positions([e]),B.get(t).cacheFacing(K.angleFromTarget(e))}}for(let t=0;t<3;t++){let e;if(I.lashes[0])e=K.rotateAndNormal(c[t],90*(3-t),9.5)[99],c[t].set_target_positions([e]);else{let s=K.rotateAndNormal(c[t],90*(3-t),5.5);c[t].set_target_positions(s),e=s[99]}B.get(c[t]).cacheFacing(K.angleFromTarget(e))}})),t.timeline.addEvent(L+14800,(()=>{for(let t of e)switch(I.debuffs.get(t)){case"1":case"1U":case"1D":let e={x:l(100,1),y:l(92.5,1)};t.set_target_positions([e]),B.get(t).cacheFacing(K.angleFromTarget(e))}for(let t=0;t<2;t++){let e={x:93+2*t*7,y:92.5};o[t].set_target_positions([e]),B.get(o[t]).cacheFacing(K.angleFromTarget(e))}for(let t=0;t<3;t++){let e;if(!I.lashes[0]){let s=K.rotateAndNormal(c[t],90*(3-t),9.5);c[t].set_target_positions([s[99]]),e=s[99],B.get(c[t]).cacheFacing(K.angleFromTarget(e))}}})),t.timeline.addEvent(L+16800,(()=>{for(let t=0;t<2;t++)null!==o[2]&&B.get(o[t]).cacheFacing(90);for(let t=0;t<3;t++){let e,s=K.rotateAndNormal(c[t],90*(3-t),5.5);c[t].set_target_positions([s[99]]),e=s[99],B.get(c[t]).cacheFacing(K.angleFromTarget(e))}})),t.timeline.addEvent(L+18100,(()=>{for(let t=0;t<3;t++){if(1==t)continue;let e={x:93+7*t,y:92.5};n[t].set_target_positions([e]),B.get(n[t]).cacheFacing(K.angleFromTarget(e))}for(let t=0;t<2;t++){let e={x:l(100,1),y:l(92.5,1)};o[t].set_target_positions([e]),B.get(o[t]).cacheFacing(K.angleFromTarget(e))}})),t.timeline.addEvent(O+3100,(()=>{for(let t=0;t<3;t++){if(1==t)continue;let e={x:92+8*t,y:92};n[t].set_target_positions([e]),B.get(n[t]).cacheFacing(K.angleFromTarget(e))}for(let t=0;t<3;t++){let e,s=K.rotateAndNormal(c[t],90*(3-t),7.5);c[t].set_target_positions([s[99]]),e=s[99],B.get(c[t]).cacheFacing(K.angleFromTarget(e))}})),t.timeline.addEvent(O+5100,(()=>{for(let t=0;t<3;t++){let e={x:l(100,1),y:l(92.5+(I.lashes[1]?1:-1),.5)};n[t].set_target_positions([e]),B.get(n[t]).cacheFacing(K.angleFromTarget(e))}for(let t=0;t<2;t++){let e={x:l(100,1),y:l(92.5+(I.lashes[1]?1:-1),.5)};o[t].set_target_positions([e]),B.get(o[t]).cacheFacing(K.angleFromTarget(e))}})),t.timeline.addEvent(O+6300,(()=>{for(let t of e)"3D"==I.debuffs.get(t)&&B.get(t).cacheFacing(K.angleFromTarget(t)+180)}));let g=[];t.timeline.addEvent(O+8e3,(()=>{for(let t of e)switch(I.debuffs.get(t)){case"3":case"3U":case"3D":if(I.lashes[1]){let e={x:l(100,1),y:l(94.5,1)};t.set_target_positions([e]),B.get(t).cacheFacing(K.angleFromTarget(e))}else{let e=K.rotateAndNormal(t,l(0,5),l(9.5,.5));t.set_target_positions(e),B.get(t).cacheFacing(K.angleFromTarget(e[99]))}}g=[o[0],n[1],o[1]];for(let t=0;t<3;t++){let e;if(I.lashes[1])e=K.rotateAndNormal(g[t],90*(3-t),5.5)[99],g[t].set_target_positions([e]);else{let s=K.rotateAndNormal(g[t],90*(3-t),9.5);g[t].set_target_positions(s),e=s[99]}B.get(g[t]).cacheFacing(K.angleFromTarget(e))}})),t.timeline.addEvent(O+11700,(()=>{for(let t of e)if(I.lashes[1]){let e=K.rotateAndNormal(t,l(0,5),l(9.5,.5));t.set_target_positions(e),B.get(t).cacheFacing(K.angleFromTarget(e[99]))}else{let e={x:l(100,1),y:l(94.5,1)};t.set_target_positions([e]),B.get(t).cacheFacing(K.angleFromTarget(e))}for(let t=0;t<3;t++){let e;if(I.lashes[1])e=K.rotateAndNormal(g[t],90*(3-t),9.5)[99],g[t].set_target_positions([e]);else{let s=K.rotateAndNormal(g[t],90*(3-t),5.5);g[t].set_target_positions(s),e=s[99]}B.get(g[t]).cacheFacing(K.angleFromTarget(e))}})),t.timeline.addEvent(O+14800,(()=>{for(let t of e){let e={x:l(100,1),y:l(92.5,1)};t.set_target_positions([e]),B.get(t).cacheFacing(K.angleFromTarget(e))}let s=K.rotateAndNormal(t.party.T1,45,7.5);t.party.T1.set_target_positions(s),B.get(t.party.T1).cacheFacing(s[99]);for(let t=0;t<3;t++){let e,s=K.rotateAndNormal(g[t],90*(3-t),9.5);g[t].set_target_positions([s[99]]),e=s[99],B.get(g[t]).cacheFacing(K.angleFromTarget(e))}})),t.timeline.addEvent(O+16800,(()=>{for(let e=0;e<3;e++){let s,i;i=Object.is(g[e],t.party.T1)?K.rotateAndNormal(g[e],215,5.5):K.rotateAndNormal(g[e],90*(3-e),5.5),g[e].set_target_positions([i[99]]),s=i[99],B.get(g[e]).cacheFacing(K.angleFromTarget(s))}}))}(t),document.getElementById("bgm").play()}}).run();let I={};const P=4500,N=9300,z=17700,L=24800,O=L+21500,U=O+24300;let K,B,j=[];
